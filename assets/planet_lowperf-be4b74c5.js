import{W as ts,P as ss,O as ns,S as as,V as z,R as os,a as B,b as v,B as T,c as D,T as S,s as is,d as rs,e as ls,f as cs,g as ds,h as us,i as hs,j as fs,k as ps,F as j,l as F,m as te,M as R,n as We,r as ms,o as ft,p as ze,q as gs,D as Pe,t as Le,u as xs,v as ys,A as pt,w as ws,x as vs,y as Ss,z as Z,C as mt,E as $,G as gt,H as pe,I as Ms,J as bs,K as xt,L as zs,N as He,Q as Ps,U as me,X as Ls,Y as Rs,Z as Is,_ as Bs,$ as qs,a0 as O,a1 as Ne,a2 as Re,a3 as yt,a4 as tt,a5 as Q,aa as L,a6 as Ie,a7 as st,a8 as Cs,a9 as Es,ab as Ts,ac as _s,ad as As,ae as Os,af as Ds,ag as nt,ah as De,ai as ve,aj as oe,ak as at,al as ot,am as js,an as je,ao as Fs,ap as Gs,aq as Se,ar as ks,as as Vs,at as de,au as Ws,av as wt,aw as Hs,ax as Ns,ay as Xs,az as Us,aA as Js}from"./sign-adccad11.js";const Ys="/Planet/assets/diffuse2kvibrance-48da219c.webp",Zs="/Planet/assets/normal2k-cf6e773f.webp",$s="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Ks="generic-trigger",vt=document.querySelector("#c"),x=new ts({canvas:vt,antialias:!0});x.setPixelRatio(window.devicePixelRatio);function Qs(n){const e=n.domElement,s=e.clientWidth,t=e.clientHeight,a=e.width!==s||e.height!==t;return a&&n.setSize(s,t,!1),a}const en=50,tn=2,sn=.1,nn=2e3,r=new ss(en,tn,sn,nn);r.position.z=500;const E=new ns(r,vt);E.enablePan=!1;E.maxDistance=1e3;E.minDistance=5.2;E.zoomSpeed=.3;E.rotateSpeed=.3;E.target.set(0,0,0);E.update();const G=new as,Be=new z,J=new os,an=new wt;new wt;let u=[],d=null,q=null,qe=null,St=null,f=null,g=[],Fe=!0,P=!1,ie=new B(r.position.x,r.position.y,r.position.z);const Me=new B(0,0,0),I=new v;let Mt=!1;const m=new Cs;m.onStart=function(n,e,s){};const on=document.getElementById("progress-bar");m.onProgress=function(n,e,s){on.value=e/s*100};const rn=document.querySelector(".progress-bar-container");m.onLoad=function(){rn.style.display="none"};m.onError=function(n){console.log("There was an error loading "+n)};const Ce=document.getElementById("enableVRbutton");Ce.addEventListener("click",()=>{Ce.style.display="none",Mt=!0});async function ln(){navigator.xr.isSessionSupported("immersive-vr").then(n=>{if(n){const e=Es.createButton(x);document.body.appendChild(e),dn()}})}Mt==!0&&ln();function cn(){window.dolly=new v,window.dummyCam=new v,window.workingMatrix=new Hs,window.buttonStates={},window.gamepadIndices="",window.info={},window.controllers={},window.elapsedTime=0,window.dollyLat=90,window.dollyLng=180,window.dollyRadius=8,window.XRinSession=!1}function dn(){x.xr.enabled=!0,cn(),r.position.set(0,1.6,0);const n=L(dollyLat,dollyLng,dollyRadius);dolly.position.set(n.x,n.y-1.6,n.z),dolly.add(r),G.add(dolly),r.add(dummyCam),x.xr.getController(0).addEventListener("connected",un);const s=new Ts,t=new T().setFromPoints([new B(0,0,0),new B(0,0,-1)]),a=new _s(t);a.scale.z=0,controllers={},controllers.right=it(0,a,s),controllers.left=it(1,a,s)}function un(n){Ee.style.display="none",Te.style.display="none",Xe.style.display="none",info={},As(n.data,$s,Ks).then(({profile:e,assetPath:s})=>{console.log(JSON.stringify(e)),info.name=e.profileId,info.targetRayMode=n.data.targetRayMode,Object.entries(e.layouts).forEach(([t,a])=>{const o={};Object.values(a.components).forEach(p=>{o[p.rootNodeName]=p.gamepadIndices}),info[t]=o}),hn(info.right),console.log(JSON.stringify(info)),fn(info)})}function hn(n){buttonStates={},gamepadIndices=n,Object.keys(n).forEach(e=>{e.indexOf("touchpad")!=-1||e.indexOf("thumbstick")!=-1?buttonStates[e]={button:0,xAxis:0,yAxis:0}:buttonStates[e]=0})}function fn(n){if(n.right!==void 0){const e=x.xr.getController(0);let s=!1,t=!1;Object.keys(n.right).forEach(a=>{a.indexOf("trigger")!=-1&&(s=!0),a.indexOf("squeeze")!=-1&&(t=!0)}),s&&(e.addEventListener("selectstart",rt),e.addEventListener("selectend",lt)),t&&(e.addEventListener("squeezestart",ct),e.addEventListener("squeezeend",dt)),e.addEventListener("disconnected",ut)}if(n.left!==void 0){const e=x.xr.getController(1);let s=!1,t=!1;Object.keys(n.left).forEach(a=>{a.indexOf("trigger")!=-1&&(s=!0),a.indexOf("squeeze")!=-1&&(t=!0)}),s&&(e.addEventListener("selectstart",rt),e.addEventListener("selectend",lt)),t&&(e.addEventListener("squeezestart",ct),e.addEventListener("squeezeend",dt)),e.addEventListener("disconnected",ut)}}function it(n,e,s){const t=x.xr.getController(n);t.userData.selectPressed=!1,t.userData.index=n,e&&t.add(e.clone()),dolly.add(t);let a;return s&&(a=x.xr.getControllerGrip(n),a.add(s.createControllerModel(a)),dolly.add(a)),{controller:t,grip:a}}function rt(){console.log("select"),this.userData.selectPressed=!0}function lt(){this.children[0].scale.z=0,this.userData.selectPressed=!1,this.userData.selected=void 0,console.log("selectend")}function ct(){this.userData.squeezePressed=!0,this.userData.selected!==void 0&&(this.attach(this.userData.selected),this.userData.attachedObject=userData.selected),console.log("squeeze")}function dt(){this.userData.squeezePressed=!1,this.userData.attachedObject!==void 0&&(room.attach(this.userData.attachedObject),this.userData.attachedObject=void 0),console.log("squeezeend")}function ut(){const n=userData.index;if(console.log(`Disconnected controller ${n}`),controllers){const e=n==0?controllers.right:controllers.left;if(e){if(e.controller){const s=e.controller;for(;s.children.length>0;)s.remove(s.children[0]);dolly.remove(s)}e.grip&&dolly.remove(e.grip)}}}function pn(n){if(n.userData.selectPressed){n.children[0].scale.z=10,workingMatrix.identity().extractRotation(n.matrixWorld),J.ray.origin.setFromMatrixPosition(n.matrixWorld),J.ray.direction.set(0,0,-1).applyMatrix4(workingMatrix);const e=J.intersectObjects(de);if(e.length>0){q=e[0].object;const s=de.findIndex(a=>a==e[0].object),t=O[s][6];t>0&&(ue=document.querySelector(`.carousel.s${t}`),ue.style.display="block"),xrSession.end().then(()=>xrSession=null)}}}function mn(){const e=x.xr.getSession().inputSources[0];if(e&&e.gamepad&&gamepadIndices&&buttonStates){const s=e.gamepad;XRinSession=!0;try{Object.entries(buttonStates).forEach(([t,a])=>{const o=gamepadIndices[t].button;if(t.indexOf("touchpad")!=-1||t.indexOf("thumbstick")!=-1){const p=gamepadIndices[t].xAxis,_=gamepadIndices[t].yAxis;buttonStates[t].button=s.buttons[o].value,buttonStates[t].xAxis=s.axes[p].toFixed(2),buttonStates[t].yAxis=s.axes[_].toFixed(2)}else buttonStates[t]=s.buttons[o].value})}catch{console.warn("An error occurred setting the ui")}}}let le=!1;const ge=document.getElementById("introTune");ge.preload="auto";ge.currentTime=0;ge.volume=1;const be=ge.duration,Ee=document.getElementById("playbutton"),Xe=document.getElementById("credits");Ee.addEventListener("click",()=>{ge.play(),le=!0,Ee.style.display="none",Te.style.display="none",Ce.style.display="none",Xe.style.display="none"});const Te=document.getElementById("skipbutton");Te.addEventListener("click",()=>{Ee.style.display="none",Te.style.display="none",Ce.style.display="none",Xe.style.display="none",r.position.z=15});let ue;const gn=document.querySelectorAll("[data-carousel-button]");gn.forEach(n=>{n.addEventListener("click",()=>{if(document.querySelector(".carousel"),n.dataset.carouselButton==="exit")ue.style.display="none";else{const e=n.dataset.carouselButton==="next"?1:-1,s=n.closest("[data-carousel]").querySelector("[data-slides]"),t=s.querySelector("[data-active]");let a=[...s.children].indexOf(t)+e;s.children[a].dataset.active=!0,delete t.dataset.active}})});const xn=document.querySelectorAll("[data-menu-button]");xn.forEach(n=>{n.addEventListener("click",()=>{if(document.querySelector(".carousel"),n.dataset.menuButton==="menu"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),s=e.querySelector("[data-active]"),t=e.querySelector("[menu]");let a=[...e.children].indexOf(t);e.children[a].dataset.active=!0,delete s.dataset.active}if(n.dataset.menuButton==="definition"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),s=e.querySelector("[data-active]"),t=e.querySelector("[definition]");let a=[...e.children].indexOf(t);e.children[a].dataset.active=!0,delete s.dataset.active}if(n.dataset.menuButton==="exercise"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),s=e.querySelector("[data-active]"),t=e.querySelector("[exercise]");let a=[...e.children].indexOf(t);e.children[a].dataset.active=!0,delete s.dataset.active}if(n.dataset.menuButton==="theory"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),s=e.querySelector("[data-active]"),t=e.querySelector("[theory]");let a=[...e.children].indexOf(t);e.children[a].dataset.active=!0,delete s.dataset.active}if(n.dataset.menuButton==="media"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),s=e.querySelector("[data-active]"),t=e.querySelector("[media]");let a=[...e.children].indexOf(t);e.children[a].dataset.active=!0,delete s.dataset.active}})});const yn=document.querySelectorAll("[data-nav-button]");yn.forEach(n=>{n.addEventListener("click",()=>{if(document.querySelector(".carousel"),n.dataset.navButton==="one"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),s=e.querySelector("[data-active]"),t=e.querySelector("[one]");let a=[...e.children].indexOf(t);e.children[a].dataset.active=!0,delete s.dataset.active}if(n.dataset.navButton==="two"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),s=e.querySelector("[data-active]"),t=e.querySelector("[two]");let a=[...e.children].indexOf(t);e.children[a].dataset.active=!0,delete s.dataset.active}if(n.dataset.navButton==="three"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),s=e.querySelector("[data-active]"),t=e.querySelector("[three]");let a=[...e.children].indexOf(t);e.children[a].dataset.active=!0,delete s.dataset.active}if(n.dataset.navButton==="four"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),s=e.querySelector("[data-active]"),t=e.querySelector("[four]");let a=[...e.children].indexOf(t);e.children[a].dataset.active=!0,delete s.dataset.active}if(n.dataset.navButton==="five"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),s=e.querySelector("[data-active]"),t=e.querySelector("[five]");let a=[...e.children].indexOf(t);e.children[a].dataset.active=!0,delete s.dataset.active}})});const bt=new T,zt=new T,Pt=new T,Lt=new T,Rt=new T,It=new T,Bt=new T,qt=new T,Ct=new T,wn=new D({size:5,map:new S(m).load(is),transparent:!0,fog:!1}),vn=new D({size:5,map:new S(m).load(rs),transparent:!0,fog:!1}),Sn=new D({size:5,map:new S(m).load(ls),transparent:!0,fog:!1}),Mn=new D({size:5,map:new S(m).load(cs),transparent:!0,fog:!1}),bn=new D({size:5,map:new S(m).load(ds),transparent:!0,fog:!1}),zn=new D({size:5,map:new S(m).load(us),transparent:!0,fog:!1}),Pn=new D({size:5,map:new S(m).load(hs),transparent:!0,fog:!1}),Ln=new D({size:5,map:new S(m).load(fs),transparent:!0,fog:!1}),Rn=new D({size:5,map:new S(m).load(ps),transparent:!0,fog:!1}),Et=[];for(let n=0;n<5e3;n++){const e=(Math.random()-.5)*2e3,s=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(s)+Math.abs(t)>400&&Et.push(e,s,t)}const Tt=[];for(let n=0;n<1e3;n++){const e=(Math.random()-.5)*2e3,s=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(s)+Math.abs(t)>400&&Tt.push(e,s,t)}const _t=[];for(let n=0;n<500;n++){const e=(Math.random()-.5)*2e3,s=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(s)+Math.abs(t)>400&&_t.push(e,s,t)}const At=[];for(let n=0;n<100;n++){const e=(Math.random()-.5)*2e3,s=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(s)+Math.abs(t)>400&&At.push(e,s,t)}const Ot=[];for(let n=0;n<25;n++){const e=(Math.random()-.5)*2e3,s=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(s)+Math.abs(t)>400&&Ot.push(e,s,t)}const Dt=[];for(let n=0;n<1e3;n++){const e=(Math.random()-.5)*2e3,s=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(s)+Math.abs(t)>400&&Dt.push(e,s,t)}const jt=[];for(let n=0;n<500;n++){const e=(Math.random()-.5)*2e3,s=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(s)+Math.abs(t)>400&&jt.push(e,s,t)}const Ft=[];for(let n=0;n<100;n++){const e=(Math.random()-.5)*2e3,s=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(s)+Math.abs(t)>400&&Ft.push(e,s,t)}const Gt=[];for(let n=0;n<25;n++){const e=(Math.random()-.5)*2e3,s=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(s)+Math.abs(t)>400&&Gt.push(e,s,t)}bt.setAttribute("position",new j(Et,3));zt.setAttribute("position",new j(Tt,3));Pt.setAttribute("position",new j(_t,3));Lt.setAttribute("position",new j(At,3));Rt.setAttribute("position",new j(Ot,3));It.setAttribute("position",new j(Dt,3));Bt.setAttribute("position",new j(jt,3));qt.setAttribute("position",new j(Ft,3));Ct.setAttribute("position",new j(Gt,3));const In=new F(bt,wn),Bn=new F(zt,vn),qn=new F(Pt,Sn),Cn=new F(Lt,Mn),En=new F(Rt,bn),Tn=new F(It,zn),_n=new F(Bt,Pn),An=new F(qt,Ln),On=new F(Ct,Rn);G.add(In,Bn,qn,Cn,En,Tn,_n,An,On);const se=new v;G.add(se);const xe=new v,ye=new v,we=new v,ne=new v;xe.rotation.y=-Math.PI/2.5;xe.rotation.x=.15;ye.rotation.y=2*Math.PI/16;ye.rotation.x=.22;we.rotation.y=2*Math.PI/2;we.rotation.x=.31;ne.rotation.y=9*Math.PI/6;ne.rotation.x=-.41;se.add(xe);se.add(ye);se.add(we);se.add(ne);const V=new S(m),kt=new te(5,250,250);kt.computeBoundingSphere();const w=new R(kt,new We({map:V.load(Ys),normalMap:V.load(Zs),roughnessMap:V.load(ms),normalScale:new z(3,3),metalness:0,roughness:.85,flatShading:!1,side:ft}));G.add(w);const Dn=new ze({map:V.load(gs),transparent:!0,side:Pe,opacity:.8}),Vt=new R(new te(5.04,50,50),Dn);w.add(Vt);const Wt=new R(new te(5,500,500),new Le({vertexShader:xs,fragmentShader:ys,blending:pt}));Wt.position.set(0,0,0);w.add(Wt);const Ue=new R(new te(5.3,50,50),new Le({vertexShader:ws,fragmentShader:vs,blending:pt,side:Ss,transparent:!0,depthWrite:!1}));Ue.position.set(0,0,0);Ue.scale.set(1.2,1.2,1.2);w.add(Ue);const ee=new v;w.add(ee);for(let n=0;n<Z.length;n++)mt(Z[n].src,Z[n].lat,Z[n].lng-180,Z[n].size/500,Z[n].radius,ee);for(let n=0;n<$.length;n++)mt($[n].src,$[n].lat,$[n].lng-180,$[n].size/500,$[n].radius,I);gt(O,ee,5);gt(Re,I,7);const Je=1e-4,_e=3,Ye=.03,Ze=5.02,he=new v;w.add(he);let $e=he;pe(O,Ne,Je,_e,Ye,Ze,$e,!1,!1);pe(O,Os,Je,_e,Ye,Ze,$e,!0,!1);pe(O,Ds,Je,_e,Ye,Ze,$e,!1,!0);const Ke=new v;I.add(Ke);let jn=Ke;pe(Re,yt,2e-4,_e,.1,7.01,jn,!1,!1);let fe=new v;ee.add(fe);fe.position.set(0,-5.05,0);const Fn=new Ms(m);Fn.load(bs,function(n){const e=n.scene;fe.add(e),e.scale.set(5,5,5),e.rotation.y+=Math.PI/2,e.rotation.x+=Math.PI/3},function(n){},function(n){console.log("An error happened")});const Ht=5,Gn=new te(Ht,50,50),kn=new xt({map:new S(m).load(zs)}),ce=new R(Gn,kn);ce.position.set(0,0,490);ne.add(ce);const Qe=new He(16777215,1.2,2e3);Qe.position.set(ce.position.x,ce.position.y,ce.position.z-Ht*1.5);ne.add(Qe);const Vn=V.load("https://jaranolsen.github.io/Planet/sunflare.webp"),Ae=V.load("https://jaranolsen.github.io/Planet/lensflare.webp"),Y=new Ps;Y.position.set(0,0,0);Y.addElement(new me(Vn,2560,0));Y.addElement(new me(Ae,60,.6));Y.addElement(new me(Ae,70,.7));Y.addElement(new me(Ae,120,.9));Y.addElement(new me(Ae,70,1));Qe.add(Y);class et{constructor(e,s,t,a,o,p){this.radius=e,this.texture=s,this.z=t,this.rotation=a,this.pivot=o,this.intensity=p}}let Wn=new et(1.5,Ns,110,-5e-4,xe,.1),Hn=new et(2.5,Xs,190,-3e-4,ye,.05),Nn=new et(1,Us,250,-1e-4,we,.005),U=[Wn,Hn,Nn];for(let n=0;n<U.length;n++){const e=new R(new te(U[n].radius,50,50),new We({map:new S(m).load(U[n].texture),metalness:0,flatShading:!1,side:ft}));e.position.set(U[n].z,0,0),U[n].pivot.add(e);const s=new He(16777215,U[n].intensity);s.position.set(U[n].z,0,0),e.add(s)}let Ve=!1;function Xn(){Ve=!0,G.add(I);let n=7,e=9,s=[],t=[];for(let i=0;i<e;i++){s[i]=[],t[i]=[];for(let y=2*Math.PI*i;y<=2*Math.PI*(i+1.0000001);y+=Math.PI/128){let H=Math.sin(y/(e*2)),N=H*n*Math.cos(y),X=H*n*Math.sin(y),ae=n/(e*Math.PI)*y;s[i].push(new B(N,ae-n,X)),i==0?y>2*Math.PI*i+(2*Math.PI*(i+1.0000001)-2*Math.PI*i)*.98&&t[i].push(new B(N,ae-n,X)):i<e?(y<2*Math.PI*i+(2*Math.PI*(i+1.0000001)-2*Math.PI*i)*.02&&t[i-1].push(new B(N,ae-n,X)),y>2*Math.PI*i+(2*Math.PI*(i+1.0000001)-2*Math.PI*i)*.98&&t[i].push(new B(N,ae-n,X))):y<2*Math.PI*i+(2*Math.PI*(i+1.0000001)-2*Math.PI*i)*.02&&t[i-1].push(new B(N,ae-n,X))}let b=new nt(s[i]);const A=new De(b,64,.01,10,!1);A.computeBoundingBox();const Zt=new Le({uniforms:{color1:{value:new ve(oe[40+i])},color2:{value:new ve(oe[40+i+1])},bboxMin:{value:A.boundingBox.min},bboxMax:{value:A.boundingBox.max}},vertexShader:at,fragmentShader:ot}),$t=new R(A,Zt);I.add($t);const Kt=new De(b,64,.12-i/70,10,!1),Qt=new xt({color:oe[40+i],transparent:!0,opacity:.6}),es=new R(Kt,Qt);if(I.add(es),I.rotation.set(0,0,0),i!==0){let y=new nt(t[i-1]);const H=new De(y,64,.15-i/70,10,!1);H.computeBoundingBox();const N=new Le({uniforms:{color1:{value:new ve(oe[40+i-1])},color2:{value:new ve(oe[40+i])},bboxMin:{value:H.boundingBox.min},bboxMax:{value:H.boundingBox.max}},vertexShader:at,fragmentShader:ot}),X=new R(H,N);I.add(X)}}const a=V.load(js);a.repeat.set(0,100),a.wrapT=je,a.rotation=Math.PI/2;const o=V.load(Fs);o.repeat.set(1,100),o.wrapS=je,o.wrapT=je,o.rotation=Math.PI/2,o.offset.set(.5,0);const p=new Gs(6.05,.05,50,100),_=new We({alphaMap:a,transparent:!0,alphaTest:.5,map:o,emissive:16777215,emissiveMap:o,emissiveIntensity:.05,color:16777215,metalness:1,roughness:.7}),M=new R(p,_);M.rotation.x=Math.PI/2,M.position.y=2.34,I.add(M)}const Ge=300,l=3e-4,ke=.01,W=new Ls;W.moveTo(l*5,l*5);W.bezierCurveTo(l*5,l*5,l*4,0,0,0);W.bezierCurveTo(-l*6,0,-l*6,l*7,-l*6,l*7);W.bezierCurveTo(-l*6,l*11,-l*3,l*15.4,l*5,l*19);W.bezierCurveTo(l*12,l*15.4,l*16,l*11,l*16,l*7);W.bezierCurveTo(l*16,l*7,l*16,0,l*10,0);W.bezierCurveTo(l*7,0,l*5,l*5,l*5,l*5);const Oe=new Rs(W);Oe.center=0;Oe.rotateZ(Math.PI/2);Oe.rotateY(Math.PI/2);class Un{constructor(e,s,t){this.lat=e,this.lng=s,this.material=t,this.gutt=new R(Oe,this.material),this.pos=new z(e,s),this.velocity=new z(Se(0,0),Se(0,1)).setLength(.001),this.acceleration=new z,this.cartesianPosition=L(this.pos.x,this.pos.y,5+ke),this.presentHeading,this.originalHeading,this.gutt.position.set(this.cartesianPosition.x,this.cartesianPosition.y,this.cartesianPosition.z),this.wander=new z(0,0),this.alignment=new z(0,0),this.cohesion=new z(0,0),this.separation=new z(0,0),this.avoidance=new z(0,0),w.add(this.gutt)}move(){this.originalHeading=Math.atan2(this.velocity.x,this.velocity.y),this.acceleration.set(0,0),this.alignment.multiplyScalar(c.alignment),this.cohesion.multiplyScalar(c.cohesion),this.separation.multiplyScalar(c.separation),this.acceleration.add(this.wander),this.acceleration.add(this.alignment),this.acceleration.add(this.cohesion),this.acceleration.add(this.separation),this.acceleration.add(this.avoidance),this.velocity.add(this.acceleration),this.velocity.clampLength(-c.max_speed,c.max_speed),this.velocity.setLength(c.max_speed),this.pos.add(this.velocity),this.pos.x<0&&(this.pos.x=Math.abs(this.pos.x),this.pos.y<180?this.pos.y+=180:this.pos.y-=180,this.velocity.x*=-1,this.velocity.y*=-1),this.pos.x>180&&(this.pos.x=180-(this.pos.x-180),this.pos.y<180?this.pos.y+=180:this.pos.y-=180,this.velocity.x*=-1,this.velocity.y*=-1),this.pos.y<0&&(this.pos.y=360+this.pos.y),this.pos.y>360&&(this.pos.y=this.pos.y-360),this.cartesianPosition=L(this.pos.x,this.pos.y,5+ke),this.cartesianVelocity=L(this.velocity.x,this.velocity.y,5+ke),this.presentHeading=Math.atan2(this.velocity.x,this.velocity.y),this.cp=new B,this.cp.set(this.cartesianPosition.x,this.cartesianPosition.y,this.cartesianPosition.z),this.gutt.lookAt(this.cp),this.gutt.rotateZ(this.presentHeading-this.originalHeading),this.gutt.position.set(this.cartesianPosition.x,this.cartesianPosition.y,this.cartesianPosition.z)}calculateWander(){this.wander.set(Se(-1e-4,1e-4),Se(-1e-4,1e-4)),this.wander.clampLength(-c.max_force,c.max_force)}calculateAlignment(){let e=0;this.alignment.set(0,0);for(let s=0;s<h.length;s++)h[s]!=this&&this.gutt.position.distanceTo(h[s].gutt.position)<c.alignment_perception_distance&&(this.alignment.add(h[s].velocity),e+=1);e>0&&(this.alignment.set(this.alignment.x/e,this.alignment.y/e),this.alignment.sub(this.velocity),this.alignment.clampLength(-c.max_force,c.max_force))}calculateCohesion(){let e=0;this.cohesion.set(0,0);for(let s=0;s<h.length;s++)h[s]!=this&&this.gutt.position.distanceTo(h[s].gutt.position)<c.cohesion_perception_distance&&(this.cohesion.add(h[s].pos),e+=1);e>0&&(this.cohesion.set(this.cohesion.x/e,this.cohesion.y/e),this.cohesion.sub(this.pos),this.cohesion.clampLength(-c.max_force,c.max_force))}calculateSeparation(){let e=0;this.separation.set(0,0);for(let s=0;s<h.length;s++)if(h[s]!=this&&this.gutt.position.distanceTo(h[s].gutt.position)<c.separation_perception_distance){let t=new z(this.pos.x-h[s].pos.x,this.pos.y-h[s].pos.y);t.divideScalar(this.gutt.position.distanceTo(h[s].gutt.position)),this.separation.add(t),e+=1}e>0&&(this.separation.set(this.separation.x/e,this.separation.y/e),this.separation.clampLength(-c.max_force,c.max_force))}calculateTemperature(){this.avoidance.set(0,0),this.pos.x<40&&(this.avoidance.set(Math.pow(40-this.pos.x,2)/1e5,0),this.avoidance.clampLength(-c.max_force,c.max_force)),this.pos.x>140&&(this.avoidance.set(-Math.pow(140-this.pos.x,2)/1e5,0),this.avoidance.clampLength(-c.max_force,c.max_force))}}let h=[];for(let n=0;n<Ge;n++){let e=ks(40,140,5),s=Vs(0,359),t,a=new ze({color:13395541,side:Pe}),o=new ze({color:13399944,side:Pe}),p=new ze({color:12272725,side:Pe});n<=Ge/3?t=a:n<Ge/3*2?t=o:t=p,h.push(new Un(e,s,t))}const Nt=new Is;let c={alignment:.016,alignment_perception_distance:.435,cohesion:.754,cohesion_perception_distance:.887,separation:.765,separation_perception_distance:.225,max_force:.0029,max_speed:.01};const k=Nt.addFolder("parameters");k.add(c,"alignment",0,.1,1e-4);k.add(c,"alignment_perception_distance",0,1,.001);k.add(c,"cohesion",0,1,.001);k.add(c,"cohesion_perception_distance",0,1,.001);k.add(c,"separation",0,1,.001);k.add(c,"separation_perception_distance",0,1,.001);k.add(c,"max_force",0,.01,1e-4);k.add(c,"max_speed",0,.1,.001);k.close();Nt.hide();const K=new Bs(16777215,.02);G.add(K);const C=new qs(15723480,0);C.penumbra=.8;C.angle=Math.PI/4;G.add(C);const Xt=new He(16777215,.5);Xt.position.set(0,0,0);w.add(Xt);u.push([O,O.length,Ne,he,5.01]);u.push([Re,u[u.length-1][1]+Re.length,yt,Ke,7.01]);const re=[];let ht;const Jn=document.querySelector("#fpsCounter"),Ut=document.createElement("div");function Jt(){window.requestAnimationFrame(()=>{const n=performance.now();for(;re.length>0&&re[0]<=n-1e3;)re.shift();re.push(n),ht=re.length,Ut.textContent=ht,Jt()})}Jn.appendChild(Ut);Jt();function Yn(){J.setFromCamera(Be,r);const n=J.intersectObjects(de);Js(n)}document.addEventListener("keyup",Zn,!1);function Zn(n){const e=n.which;if(e==49&&(C.intensity=0),e==50&&(C.intensity=.5),e==51&&(C.intensity=1),e==52&&(C.intensity=1.5),e==53&&(C.intensity=2),e==54&&(K.intensity=0),e==55&&(K.intensity=.02),e==56&&(K.intensity=.1),e==57&&(K.intensity=.5),e==48&&(K.intensity=1),e==65&&(g.length=0),e==90&&f!==null&&(g.indexOf(f)==-1&&g.push(f),console.log(g)),e==67&&(Fe==!0?(w.remove(ee),w.remove(he),Fe=!1):(w.add(ee),w.add(he),Fe=!0)),e==70&&(P==!0?P=!1:P=!0),e==81){let s="";const t=u[d][0];for(let a=0;a<t.length;a++)s=s+'    {id: "'+t[a].id+'", text: '+JSON.stringify(t[a].text)+", lat: "+t[a].lat+", lng: "+t[a].lng+", color: "+t[a].color+", size: "+t[a].size+", slides: "+t[a].slides+`},
`;console.log(s)}if(e==83&&(Ve==!1?Xn():(Ve=!1,G.remove(I))),e==87){const s=[u[d][0],u[d][2],u[d][3],u[d][4]];s[2].clear();const t=2e-4,a=3,o=.03;pe(s[0],s[1],t,a,o,s[3],s[2])}if(e==187){let s=0,t=0,a={context:u[d][0]},o;d>0?o=u[d-1][1]:o=0,f&&(s=Q[f].originalSize),a.context[f-o].size+=5,t=a.context[f-o].size,q.scale.set(t/s,t/s,t/s),qe.scale.set(t/s,t/s,t/s)}if(e==189){let s=0,t=0,a={context:u[d][0]},o;d>0?o=u[d-1][1]:o=0,f&&(s=Q[f].originalSize),a.context[f-o].size-=5,t=a.context[f-o].size,q.scale.set(t/s,t/s,t/s),qe.scale.set(t/s,t/s,t/s)}}document.addEventListener("keydown",$n,!1);function $n(n){const e=n.which;if(g.length>0){const s={context:u[d][0],length:u[d][1],radius:u[d][4]};for(let t=0;t<g.length;t++)if(e==38||e==40||e==37||e==39){let a=tt(Q[g[t]].pin.position.x,Q[g[t]].pin.position.y,Q[g[t]].pin.position.z);e==38?(P&&(a.lat-=.4),a.lat-=.1):e==40?(P&&(a.lat+=.4),a.lat+=.1):e==37?(P&&(a.lng-=.4),a.lng-=.1):e==39&&(P&&(a.lng+=.4),a.lng+=.1);const o=s.radius,p=s.radius+.04,_=s.radius+.05,M=L(a.lat,a.lng,o),i=L(a.lat,a.lng,p),b=L(a.lat,a.lng,_);Q[g[t]].pin.position.set(M.x,M.y,M.z),Ie[g[t]].box.position.set(i.x,i.y,i.z),Ie[g[t]].tag.position.set(b.x,b.y,b.z),a=st(a.lat,a.lng-180);let A;d>0?A=u[d-1][1]:A=0,s.context[g[t]-A].lat=a.lat.toFixed(1),s.context[g[t]-A].lng=a.lng.toFixed(1)}}else if(q!=null){const s={context:u[d][0],length:u[d][1],radius:u[d][4]};if(e==38||e==40||e==37||e==39){let t=tt(q.position.x,q.position.y,q.position.z);e==38?(P&&(t.lat-=.4),t.lat-=.1):e==40?(P&&(t.lat+=.4),t.lat+=.1):e==37?(P&&(t.lng-=.4),t.lng-=.1):e==39&&(P&&(t.lng+=.4),t.lng+=.1);const a=s.radius,o=s.radius+.04,p=s.radius+.05,_=L(t.lat,t.lng,a),M=L(t.lat,t.lng,o),i=L(t.lat,t.lng,p);q.position.set(_.x,_.y,_.z),qe.position.set(M.x,M.y,M.z),St.position.set(i.x,i.y,i.z),t=st(t.lat,t.lng-180);let b;d>0?b=u[d-1][1]:b=0,s.context[f-b].lat=t.lat.toFixed(1),s.context[f-b].lng=t.lng.toFixed(1)}}}function Kn(n){Be.x=n.clientX/window.innerWidth*2-1,Be.y=-(n.clientY/window.innerHeight)*2+1}function Yt(n){J.setFromCamera(Be,r);const e=J.intersectObjects(de);if(e.length>0){q=e[0].object,f=de.findIndex(o=>o==e[0].object),qe=Ie[f].box,St=Ie[f].tag;const s=d;for(let o=0;o<100;o++)if(f<u[o][1]){d=o,d!==s&&(g.length=0);break}let t;d>0?t=u[d-1][1]:t=0;let a=u[d][0];if(r.position.distanceTo(q.position)<4&&a[f-t].slides!==void 0){const o=O[f].slides;Ws(o),ue=document.querySelector(".carousel.s1"),ue.style.display="block"}}}window.addEventListener("pointermove",Kn);window.addEventListener("click",Yt);window.addEventListener("touchstart",Yt);O.length!==Ne.length&&console.log("ERROR: tagPlanetData.length !== tagPlanetConnections.length");function Qn(){x.setAnimationLoop(ea)}function ea(n){if(x.xr.isPresenting){const t=an.getDelta();if(controllers&&Object.values(controllers).forEach(a=>{pn(a.controller)}),elapsedTime===void 0&&(elapsedTime=0),elapsedTime+=t,elapsedTime>.3&&(mn(),elapsedTime=0),XRinSession==!0){const a=Number(buttonStates.xr_standard_thumbstick.xAxis),o=Number(buttonStates.xr_standard_thumbstick.yAxis);if(a!=0||o!=0||buttonStates.a_button!=0||buttonStates.b_button!=0){dollyLng+=a*2,dollyLat+=o,dollyRadius+=(.1*buttonStates.a_button-.1*buttonStates.b_button)*(dollyRadius-5);const p=L(dollyLat,dollyLng,dollyRadius);dolly.position.set(p.x,p.y-1.6,p.z)}}}if(Qs(x)){const t=x.domElement;r.aspect=t.clientWidth/t.clientHeight,r.updateProjectionMatrix()}for(let t=0;t<h.length;t++)h[t].calculateWander(),h[t].calculateAlignment(),h[t].calculateCohesion(),h[t].calculateSeparation(),h[t].calculateTemperature(),h[t].move();x.render(G,r);const e=r.position,s=r.rotation;C.position.set(e.x,e.y,e.z),C.rotation.set(s.x,s.y,s.z),se.rotation.y+=-1e-5,xe.rotation.y+=-3e-4,ye.rotation.y+=-3e-5,we.rotation.y+=-9e-6,ne.rotation.y+=-1e-4,Vt.rotation.y+=1e-5,r.position.z>15&&le==!0&&(r.position.z-=.0213*Math.pow(r.position.z-10,1.35)/be),r.position.z<-15&&le==!0&&(r.position.z+=.213*Math.pow(Math.abs(r.position.z)-10,1.35)/be),le==!0&&(r.position.x+=.4/be,r.position.y+=.1/be),r.position.z>-15&&r.position.z<15&&(le=!1),E.rotateSpeed=(r.position.distanceTo(Me)-5)/r.position.distanceTo(Me),E.zoomSpeed=(r.position.distanceTo(Me)-5)/r.position.distanceTo(Me)/3,fe&&(ie.set(r.position.x,r.position.y,r.position.z),ie.normalize(),fe.lookAt(ie.x,ie.y,ie.z)),Yn(),E.update()}Qn();
