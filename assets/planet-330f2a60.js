var oi=Object.defineProperty;var ai=(n,e,t)=>e in n?oi(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Nt=(n,e,t)=>(ai(n,typeof e!="symbol"?e+"":e,t),t);import{G as ln,O as z,S as fe,M as xt,a as F,W as ri,P as li,b as di,c as ci,V as G,R as ui,d as Y,B as Q,e as ee,T as D,s as hi,f as fi,g as pi,h as mi,i as _i,j as gi,k as vi,l as bi,m as yi,F as te,n as ne,o as wt,p as dn,q as cn,D as un,r as Je,A as hn,t as xi,u as _e,v as fn,w as ge,x as pn,y as rt,z as wi,C as Si,E as St,L as Ei,H as Ve,I as Ci,J as Ai,K as Oi,N as Ti,Q as oe,U as Et,X as Qe,Y as mn,Z as It,_ as Z,$ as Ze,a0 as Bt,a1 as Mi,a2 as U,a3 as ki,a4 as Li,a5 as zt,a6 as ct,a7 as qe,a8 as Ce,a9 as Ft,aa as Dt,ab as Ri,ac as ut,ad as Pi,ae as Ni,af as $e,ag as Ii,ah as Bi,ai as _n,aj as zi,ak as Ie,al as Fi,am as Di,an as Vi}from"./sign-cfc595ae.js";const at=class{static createButton(e){const t=document.createElement("button");function i(){let l=null;async function u(h){h.addEventListener("end",f),await e.xr.setSession(h),t.textContent="EXIT VR",l=h}function f(){l.removeEventListener("end",f),t.textContent="ENTER VR",l=null}t.style.display="",t.style.cursor="pointer",t.style.left="calc(50% - 50px)",t.style.width="100px",t.textContent="ENTER VR",t.onmouseenter=function(){t.style.opacity="1.0"},t.onmouseleave=function(){t.style.opacity="0.5"},t.onclick=function(){if(l===null){const h={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",h).then(u)}else l.end()}}function s(){t.style.display="",t.style.cursor="auto",t.style.left="calc(50% - 75px)",t.style.width="150px",t.onmouseenter=null,t.onmouseleave=null,t.onclick=null}function o(){s(),t.textContent="VR NOT SUPPORTED"}function a(l){s(),console.warn("Exception when trying to call xr.isSessionSupported",l),t.textContent="VR NOT ALLOWED"}function d(l){l.style.position="absolute",l.style.bottom="20px",l.style.padding="12px 6px",l.style.border="1px solid #fff",l.style.borderRadius="4px",l.style.background="rgba(0,0,0,0.1)",l.style.color="#fff",l.style.font="normal 13px sans-serif",l.style.textAlign="center",l.style.opacity="0.5",l.style.outline="none",l.style.zIndex="999"}if("xr"in navigator)return t.id="VRButton",t.style.display="none",d(t),navigator.xr.isSessionSupported("immersive-vr").then(function(l){l?i():o(),l&&at.xrSessionIsGranted&&t.click()}).catch(a),t;{const l=document.createElement("a");return window.isSecureContext===!1?(l.href=document.location.href.replace(/^http:/,"https:"),l.innerHTML="WEBXR NEEDS HTTPS"):(l.href="https://immersiveweb.dev/",l.innerHTML="WEBXR NOT AVAILABLE"),l.style.left="calc(50% - 90px)",l.style.width="180px",l.style.textDecoration="none",d(l),l}}static registerSessionGrantedListener(){if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{at.xrSessionIsGranted=!0})}}};let Le=at;Nt(Le,"xrSessionIsGranted",!1);Le.registerSessionGrantedListener();const S={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function gn(n){const e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function Hi(n){if(!n)throw new Error("No basePath supplied");return await gn(`${n}/profilesList.json`)}async function vn(n,e,t=null,i=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const s=await Hi(e);let o;if(n.profiles.some(l=>{const u=s[l];return u&&(o={profileId:l,profilePath:`${e}/${u.path}`,deprecated:!!u.deprecated}),!!o}),!o){if(!t)throw new Error("No matching profile name found");const l=s[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);o={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}const a=await gn(o.profilePath);let d;if(i){let l;if(n.handedness==="any"?l=a.layouts[Object.keys(a.layouts)[0]]:l=a.layouts[n.handedness],!l)throw new Error(`No matching handedness, ${n.handedness}, in profile ${o.profileId}`);l.assetPath&&(d=o.profilePath.replace("profile.json",l.assetPath))}return{profile:a,assetPath:d}}const Gi={xAxis:0,yAxis:0,button:0,state:S.ComponentState.DEFAULT};function ji(n=0,e=0){let t=n,i=e;if(Math.sqrt(n*n+e*e)>1){const a=Math.atan2(e,n);t=Math.cos(a),i=Math.sin(a)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:i*.5+.5}}class Ui{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===S.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(Gi)}updateFromComponent({xAxis:e,yAxis:t,button:i,state:s}){const{normalizedXAxis:o,normalizedYAxis:a}=ji(e,t);switch(this.componentProperty){case S.ComponentProperty.X_AXIS:this.value=this.states.includes(s)?o:.5;break;case S.ComponentProperty.Y_AXIS:this.value=this.states.includes(s)?a:.5;break;case S.ComponentProperty.BUTTON:this.value=this.states.includes(s)?i:0;break;case S.ComponentProperty.STATE:this.valueNodeProperty===S.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(s):this.value=this.states.includes(s)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class qi{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(i=>{const s=new Ui(t.visualResponses[i]);this.visualResponses[i]=s}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:S.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=S.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=S.ComponentState.PRESSED:(t.touched||this.values.button>S.ButtonTouchThreshold)&&(this.values.state=S.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===S.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>S.AxisTouchThreshold&&(this.values.state=S.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===S.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>S.AxisTouchThreshold&&(this.values.state=S.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class $i{constructor(e,t,i){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=i,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(s=>{const o=this.layoutDescription.components[s];this.components[s]=new qi(s,o)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const Xi="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Wi="generic-trigger";class Yi extends z{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(i=>{const{valueNode:s,minNode:o,maxNode:a,value:d,valueNodeProperty:l}=i;!s||(l===S.VisualResponseProperty.VISIBILITY?s.visible=d:l===S.VisualResponseProperty.TRANSFORM&&(s.quaternion.slerpQuaternions(o.quaternion,a.quaternion,d),s.position.lerpVectors(o.position,a.position,d)))})}))}}function Ki(n,e){Object.values(n.components).forEach(t=>{const{type:i,touchPointNodeName:s,visualResponses:o}=t;if(i===S.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(s),t.touchPointNode){const a=new fe(.001),d=new xt({color:255}),l=new F(a,d);t.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(o).forEach(a=>{const{valueNodeName:d,minNodeName:l,maxNodeName:u,valueNodeProperty:f}=a;if(f===S.VisualResponseProperty.TRANSFORM){if(a.minNode=e.getObjectByName(l),a.maxNode=e.getObjectByName(u),!a.minNode){console.warn(`Could not find ${l} in the model`);return}if(!a.maxNode){console.warn(`Could not find ${u} in the model`);return}}a.valueNode=e.getObjectByName(d),a.valueNode||console.warn(`Could not find ${d} in the model`)})})}function Vt(n,e){Ki(n.motionController,e),n.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=n.envMap,t.material.needsUpdate=!0)}),n.add(e)}class Ji{constructor(e=null){this.gltfLoader=e,this.path=Xi,this._assetCache={},this.gltfLoader||(this.gltfLoader=new ln)}createControllerModel(e){const t=new Yi;let i=null;return e.addEventListener("connected",s=>{const o=s.data;o.targetRayMode!=="tracked-pointer"||!o.gamepad||vn(o,this.path,Wi).then(({profile:a,assetPath:d})=>{t.motionController=new $i(o,a,d);const l=this._assetCache[t.motionController.assetUrl];if(l)i=l.scene.clone(),Vt(t,i);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,u=>{this._assetCache[t.motionController.assetUrl]=u,i=u.scene.clone(),Vt(t,i)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(a=>{console.warn(a)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(i),i=null}),t}}function Qi(n){if(!!n&&!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=n,document.head.appendChild(e),n}}function xe(n,e){var t=n.__state.conversionName.toString(),i=Math.round(n.r),s=Math.round(n.g),o=Math.round(n.b),a=n.a,d=Math.round(n.h),l=n.s.toFixed(1),u=n.v.toFixed(1);if(e||t==="THREE_CHAR_HEX"||t==="SIX_CHAR_HEX"){for(var f=n.hex.toString(16);f.length<6;)f="0"+f;return"#"+f}else{if(t==="CSS_RGB")return"rgb("+i+","+s+","+o+")";if(t==="CSS_RGBA")return"rgba("+i+","+s+","+o+","+a+")";if(t==="HEX")return"0x"+n.hex.toString(16);if(t==="RGB_ARRAY")return"["+i+","+s+","+o+"]";if(t==="RGBA_ARRAY")return"["+i+","+s+","+o+","+a+"]";if(t==="RGB_OBJ")return"{r:"+i+",g:"+s+",b:"+o+"}";if(t==="RGBA_OBJ")return"{r:"+i+",g:"+s+",b:"+o+",a:"+a+"}";if(t==="HSV_OBJ")return"{h:"+d+",s:"+l+",v:"+u+"}";if(t==="HSVA_OBJ")return"{h:"+d+",s:"+l+",v:"+u+",a:"+a+"}"}return"unknown format"}var Ht=Array.prototype.forEach,Ae=Array.prototype.slice,c={BREAK:{},extend:function(e){return this.each(Ae.call(arguments,1),function(t){var i=this.isObject(t)?Object.keys(t):[];i.forEach(function(s){this.isUndefined(t[s])||(e[s]=t[s])}.bind(this))},this),e},defaults:function(e){return this.each(Ae.call(arguments,1),function(t){var i=this.isObject(t)?Object.keys(t):[];i.forEach(function(s){this.isUndefined(e[s])&&(e[s]=t[s])}.bind(this))},this),e},compose:function(){var e=Ae.call(arguments);return function(){for(var t=Ae.call(arguments),i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},each:function(e,t,i){if(!!e){if(Ht&&e.forEach&&e.forEach===Ht)e.forEach(t,i);else if(e.length===e.length+0){var s=void 0,o=void 0;for(s=0,o=e.length;s<o;s++)if(s in e&&t.call(i,e[s],s)===this.BREAK)return}else for(var a in e)if(t.call(i,e[a],a)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,t,i){var s=void 0;return function(){var o=this,a=arguments;function d(){s=null,i||e.apply(o,a)}var l=i||!s;clearTimeout(s),s=setTimeout(d,t),l&&e.apply(o,a)}},toArray:function(e){return e.toArray?e.toArray():Ae.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(n){function e(t){return n.apply(this,arguments)}return e.toString=function(){return n.toString()},e}(function(n){return isNaN(n)}),isArray:Array.isArray||function(n){return n.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},Zi=[{litmus:c.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:xe},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:xe},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:xe},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:xe}}},{litmus:c.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:c.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:c.isObject,conversions:{RGBA_OBJ:{read:function(e){return c.isNumber(e.r)&&c.isNumber(e.g)&&c.isNumber(e.b)&&c.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return c.isNumber(e.r)&&c.isNumber(e.g)&&c.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return c.isNumber(e.h)&&c.isNumber(e.s)&&c.isNumber(e.v)&&c.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return c.isNumber(e.h)&&c.isNumber(e.s)&&c.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],Oe=void 0,Xe=void 0,pt=function(){Xe=!1;var e=arguments.length>1?c.toArray(arguments):arguments[0];return c.each(Zi,function(t){if(t.litmus(e))return c.each(t.conversions,function(i,s){if(Oe=i.read(e),Xe===!1&&Oe!==!1)return Xe=Oe,Oe.conversionName=s,Oe.conversion=i,c.BREAK}),c.BREAK}),Xe},Gt=void 0,et={hsv_to_rgb:function(e,t,i){var s=Math.floor(e/60)%6,o=e/60-Math.floor(e/60),a=i*(1-t),d=i*(1-o*t),l=i*(1-(1-o)*t),u=[[i,l,a],[d,i,a],[a,i,l],[a,d,i],[l,a,i],[i,a,d]][s];return{r:u[0]*255,g:u[1]*255,b:u[2]*255}},rgb_to_hsv:function(e,t,i){var s=Math.min(e,t,i),o=Math.max(e,t,i),a=o-s,d=void 0,l=void 0;if(o!==0)l=a/o;else return{h:NaN,s:0,v:0};return e===o?d=(t-i)/a:t===o?d=2+(i-e)/a:d=4+(e-t)/a,d/=6,d<0&&(d+=1),{h:d*360,s:l,v:o/255}},rgb_to_hex:function(e,t,i){var s=this.hex_with_component(0,2,e);return s=this.hex_with_component(s,1,t),s=this.hex_with_component(s,0,i),s},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(e,t,i){return i<<(Gt=t*8)|e&~(255<<Gt)}},es=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},q=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},$=function(){function n(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),ae=function n(e,t,i){e===null&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,t);if(s===void 0){var o=Object.getPrototypeOf(e);return o===null?void 0:n(o,t,i)}else{if("value"in s)return s.value;var a=s.get;return a===void 0?void 0:a.call(i)}},le=function(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)},de=function(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:n},O=function(){function n(){if(q(this,n),this.__state=pt.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return $(n,[{key:"toString",value:function(){return xe(this)}},{key:"toHexString",value:function(){return xe(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),n}();function Ct(n,e,t){Object.defineProperty(n,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(O.recalculateRGB(this,e,t),this.__state[e])},set:function(s){this.__state.space!=="RGB"&&(O.recalculateRGB(this,e,t),this.__state.space="RGB"),this.__state[e]=s}})}function At(n,e){Object.defineProperty(n,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(O.recalculateHSV(this),this.__state[e])},set:function(i){this.__state.space!=="HSV"&&(O.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=i}})}O.recalculateRGB=function(n,e,t){if(n.__state.space==="HEX")n.__state[e]=et.component_from_hex(n.__state.hex,t);else if(n.__state.space==="HSV")c.extend(n.__state,et.hsv_to_rgb(n.__state.h,n.__state.s,n.__state.v));else throw new Error("Corrupted color state")};O.recalculateHSV=function(n){var e=et.rgb_to_hsv(n.r,n.g,n.b);c.extend(n.__state,{s:e.s,v:e.v}),c.isNaN(e.h)?c.isUndefined(n.__state.h)&&(n.__state.h=0):n.__state.h=e.h};O.COMPONENTS=["r","g","b","h","s","v","hex","a"];Ct(O.prototype,"r",2);Ct(O.prototype,"g",1);Ct(O.prototype,"b",0);At(O.prototype,"h");At(O.prototype,"s");At(O.prototype,"v");Object.defineProperty(O.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(O.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=et.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var pe=function(){function n(e,t){q(this,n),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return $(n,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),n}(),ts={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},bn={};c.each(ts,function(n,e){c.each(n,function(t){bn[t]=e})});var ns=/(\d+(\.\d+)?)px/;function X(n){if(n==="0"||c.isUndefined(n))return 0;var e=n.match(ns);return c.isNull(e)?0:parseFloat(e[1])}var r={makeSelectable:function(e,t){e===void 0||e.style===void 0||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,i){var s=i,o=t;c.isUndefined(o)&&(o=!0),c.isUndefined(s)&&(s=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),s&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,i,s){var o=i||{},a=bn[t];if(!a)throw new Error("Event type "+t+" not supported.");var d=document.createEvent(a);switch(a){case"MouseEvents":{var l=o.x||o.clientX||0,u=o.y||o.clientY||0;d.initMouseEvent(t,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,l,u,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var f=d.initKeyboardEvent||d.initKeyEvent;c.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),f(t,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break}default:{d.initEvent(t,o.bubbles||!1,o.cancelable||!0);break}}c.defaults(d,s),e.dispatchEvent(d)},bind:function(e,t,i,s){var o=s||!1;return e.addEventListener?e.addEventListener(t,i,o):e.attachEvent&&e.attachEvent("on"+t,i),r},unbind:function(e,t,i,s){var o=s||!1;return e.removeEventListener?e.removeEventListener(t,i,o):e.detachEvent&&e.detachEvent("on"+t,i),r},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var i=e.className.split(/ +/);i.indexOf(t)===-1&&(i.push(t),e.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return r},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var i=e.className.split(/ +/),s=i.indexOf(t);s!==-1&&(i.splice(s,1),e.className=i.join(" "))}else e.className=void 0;return r},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return X(t["border-left-width"])+X(t["border-right-width"])+X(t["padding-left"])+X(t["padding-right"])+X(t.width)},getHeight:function(e){var t=getComputedStyle(e);return X(t["border-top-width"])+X(t["border-bottom-width"])+X(t["padding-top"])+X(t["padding-bottom"])+X(t.height)},getOffset:function(e){var t=e,i={left:0,top:0};if(t.offsetParent)do i.left+=t.offsetLeft,i.top+=t.offsetTop,t=t.offsetParent;while(t);return i},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},yn=function(n){le(e,n);function e(t,i){q(this,e);var s=de(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=s;s.__prev=s.getValue(),s.__checkbox=document.createElement("input"),s.__checkbox.setAttribute("type","checkbox");function a(){o.setValue(!o.__prev)}return r.bind(s.__checkbox,"change",a,!1),s.domElement.appendChild(s.__checkbox),s.updateDisplay(),s}return $(e,[{key:"setValue",value:function(i){var s=ae(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),s}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),ae(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(pe),is=function(n){le(e,n);function e(t,i,s){q(this,e);var o=de(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),a=s,d=o;if(o.__select=document.createElement("select"),c.isArray(a)){var l={};c.each(a,function(u){l[u]=u}),a=l}return c.each(a,function(u,f){var h=document.createElement("option");h.innerHTML=f,h.setAttribute("value",u),d.__select.appendChild(h)}),o.updateDisplay(),r.bind(o.__select,"change",function(){var u=this.options[this.selectedIndex].value;d.setValue(u)}),o.domElement.appendChild(o.__select),o}return $(e,[{key:"setValue",value:function(i){var s=ae(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),s}},{key:"updateDisplay",value:function(){return r.isActive(this.__select)?this:(this.__select.value=this.getValue(),ae(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(pe),ss=function(n){le(e,n);function e(t,i){q(this,e);var s=de(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=s;function a(){o.setValue(o.__input.value)}function d(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),r.bind(s.__input,"keyup",a),r.bind(s.__input,"change",a),r.bind(s.__input,"blur",d),r.bind(s.__input,"keydown",function(l){l.keyCode===13&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return $(e,[{key:"updateDisplay",value:function(){return r.isActive(this.__input)||(this.__input.value=this.getValue()),ae(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(pe);function jt(n){var e=n.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var xn=function(n){le(e,n);function e(t,i,s){q(this,e);var o=de(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),a=s||{};return o.__min=a.min,o.__max=a.max,o.__step=a.step,c.isUndefined(o.__step)?o.initialValue===0?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=jt(o.__impliedStep),o}return $(e,[{key:"setValue",value:function(i){var s=i;return this.__min!==void 0&&s<this.__min?s=this.__min:this.__max!==void 0&&s>this.__max&&(s=this.__max),this.__step!==void 0&&s%this.__step!==0&&(s=Math.round(s/this.__step)*this.__step),ae(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,s)}},{key:"min",value:function(i){return this.__min=i,this}},{key:"max",value:function(i){return this.__max=i,this}},{key:"step",value:function(i){return this.__step=i,this.__impliedStep=i,this.__precision=jt(i),this}}]),e}(pe);function os(n,e){var t=Math.pow(10,e);return Math.round(n*t)/t}var tt=function(n){le(e,n);function e(t,i,s){q(this,e);var o=de(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,s));o.__truncationSuspended=!1;var a=o,d=void 0;function l(){var E=parseFloat(a.__input.value);c.isNaN(E)||a.setValue(E)}function u(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function f(){u()}function h(E){var p=d-E.clientY;a.setValue(a.getValue()+p*a.__impliedStep),d=E.clientY}function g(){r.unbind(window,"mousemove",h),r.unbind(window,"mouseup",g),u()}function N(E){r.bind(window,"mousemove",h),r.bind(window,"mouseup",g),d=E.clientY}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),r.bind(o.__input,"change",l),r.bind(o.__input,"blur",f),r.bind(o.__input,"mousedown",N),r.bind(o.__input,"keydown",function(E){E.keyCode===13&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,u())}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return $(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():os(this.getValue(),this.__precision),ae(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(xn);function Ut(n,e,t,i,s){return i+(s-i)*((n-e)/(t-e))}var mt=function(n){le(e,n);function e(t,i,s,o,a){q(this,e);var d=de(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,{min:s,max:o,step:a})),l=d;d.__background=document.createElement("div"),d.__foreground=document.createElement("div"),r.bind(d.__background,"mousedown",u),r.bind(d.__background,"touchstart",g),r.addClass(d.__background,"slider"),r.addClass(d.__foreground,"slider-fg");function u(p){document.activeElement.blur(),r.bind(window,"mousemove",f),r.bind(window,"mouseup",h),f(p)}function f(p){p.preventDefault();var T=l.__background.getBoundingClientRect();return l.setValue(Ut(p.clientX,T.left,T.right,l.__min,l.__max)),!1}function h(){r.unbind(window,"mousemove",f),r.unbind(window,"mouseup",h),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function g(p){p.touches.length===1&&(r.bind(window,"touchmove",N),r.bind(window,"touchend",E),N(p))}function N(p){var T=p.touches[0].clientX,C=l.__background.getBoundingClientRect();l.setValue(Ut(T,C.left,C.right,l.__min,l.__max))}function E(){r.unbind(window,"touchmove",N),r.unbind(window,"touchend",E),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}return d.updateDisplay(),d.__background.appendChild(d.__foreground),d.domElement.appendChild(d.__background),d}return $(e,[{key:"updateDisplay",value:function(){var i=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=i*100+"%",ae(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(xn),wn=function(n){le(e,n);function e(t,i,s){q(this,e);var o=de(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),a=o;return o.__button=document.createElement("div"),o.__button.innerHTML=s===void 0?"Fire":s,r.bind(o.__button,"click",function(d){return d.preventDefault(),a.fire(),!1}),r.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return $(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(pe),_t=function(n){le(e,n);function e(t,i){q(this,e);var s=de(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));s.__color=new O(s.getValue()),s.__temp=new O(0);var o=s;s.domElement=document.createElement("div"),r.makeSelectable(s.domElement,!1),s.__selector=document.createElement("div"),s.__selector.className="selector",s.__saturation_field=document.createElement("div"),s.__saturation_field.className="saturation-field",s.__field_knob=document.createElement("div"),s.__field_knob.className="field-knob",s.__field_knob_border="2px solid ",s.__hue_knob=document.createElement("div"),s.__hue_knob.className="hue-knob",s.__hue_field=document.createElement("div"),s.__hue_field.className="hue-field",s.__input=document.createElement("input"),s.__input.type="text",s.__input_textShadow="0 1px 1px ",r.bind(s.__input,"keydown",function(p){p.keyCode===13&&h.call(this)}),r.bind(s.__input,"blur",h),r.bind(s.__selector,"mousedown",function(){r.addClass(this,"drag").bind(window,"mouseup",function(){r.removeClass(o.__selector,"drag")})}),r.bind(s.__selector,"touchstart",function(){r.addClass(this,"drag").bind(window,"touchend",function(){r.removeClass(o.__selector,"drag")})});var a=document.createElement("div");c.extend(s.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),c.extend(s.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:s.__field_knob_border+(s.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),c.extend(s.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),c.extend(s.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),c.extend(a.style,{width:"100%",height:"100%",background:"none"}),qt(a,"top","rgba(0,0,0,0)","#000"),c.extend(s.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),rs(s.__hue_field),c.extend(s.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:s.__input_textShadow+"rgba(0,0,0,0.7)"}),r.bind(s.__saturation_field,"mousedown",d),r.bind(s.__saturation_field,"touchstart",d),r.bind(s.__field_knob,"mousedown",d),r.bind(s.__field_knob,"touchstart",d),r.bind(s.__hue_field,"mousedown",l),r.bind(s.__hue_field,"touchstart",l);function d(p){N(p),r.bind(window,"mousemove",N),r.bind(window,"touchmove",N),r.bind(window,"mouseup",u),r.bind(window,"touchend",u)}function l(p){E(p),r.bind(window,"mousemove",E),r.bind(window,"touchmove",E),r.bind(window,"mouseup",f),r.bind(window,"touchend",f)}function u(){r.unbind(window,"mousemove",N),r.unbind(window,"touchmove",N),r.unbind(window,"mouseup",u),r.unbind(window,"touchend",u),g()}function f(){r.unbind(window,"mousemove",E),r.unbind(window,"touchmove",E),r.unbind(window,"mouseup",f),r.unbind(window,"touchend",f),g()}function h(){var p=pt(this.value);p!==!1?(o.__color.__state=p,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function g(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}s.__saturation_field.appendChild(a),s.__selector.appendChild(s.__field_knob),s.__selector.appendChild(s.__saturation_field),s.__selector.appendChild(s.__hue_field),s.__hue_field.appendChild(s.__hue_knob),s.domElement.appendChild(s.__input),s.domElement.appendChild(s.__selector),s.updateDisplay();function N(p){p.type.indexOf("touch")===-1&&p.preventDefault();var T=o.__saturation_field.getBoundingClientRect(),C=p.touches&&p.touches[0]||p,V=C.clientX,k=C.clientY,I=(V-T.left)/(T.right-T.left),H=1-(k-T.top)/(T.bottom-T.top);return H>1?H=1:H<0&&(H=0),I>1?I=1:I<0&&(I=0),o.__color.v=H,o.__color.s=I,o.setValue(o.__color.toOriginal()),!1}function E(p){p.type.indexOf("touch")===-1&&p.preventDefault();var T=o.__hue_field.getBoundingClientRect(),C=p.touches&&p.touches[0]||p,V=C.clientY,k=1-(V-T.top)/(T.bottom-T.top);return k>1?k=1:k<0&&(k=0),o.__color.h=k*360,o.setValue(o.__color.toOriginal()),!1}return s}return $(e,[{key:"updateDisplay",value:function(){var i=pt(this.getValue());if(i!==!1){var s=!1;c.each(O.COMPONENTS,function(d){if(!c.isUndefined(i[d])&&!c.isUndefined(this.__color.__state[d])&&i[d]!==this.__color.__state[d])return s=!0,{}},this),s&&c.extend(this.__color.__state,i)}c.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,a=255-o;c.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,qt(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),c.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}}]),e}(pe),as=["-moz-","-o-","-webkit-","-ms-",""];function qt(n,e,t,i){n.style.background="",c.each(as,function(s){n.style.cssText+="background: "+s+"linear-gradient("+e+", "+t+" 0%, "+i+" 100%); "})}function rs(n){n.style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var ls={load:function(e,t){var i=t||document,s=i.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=e,i.getElementsByTagName("head")[0].appendChild(s)},inject:function(e,t){var i=t||document,s=document.createElement("style");s.type="text/css",s.innerHTML=e;var o=i.getElementsByTagName("head")[0];try{o.appendChild(s)}catch{}}},ds=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,cs=function(e,t){var i=e[t];return c.isArray(arguments[2])||c.isObject(arguments[2])?new is(e,t,arguments[2]):c.isNumber(i)?c.isNumber(arguments[2])&&c.isNumber(arguments[3])?c.isNumber(arguments[4])?new mt(e,t,arguments[2],arguments[3],arguments[4]):new mt(e,t,arguments[2],arguments[3]):c.isNumber(arguments[4])?new tt(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new tt(e,t,{min:arguments[2],max:arguments[3]}):c.isString(i)?new ss(e,t):c.isFunction(i)?new wn(e,t,""):c.isBoolean(i)?new yn(e,t):null};function us(n){setTimeout(n,1e3/60)}var hs=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||us,fs=function(){function n(){q(this,n),this.backgroundElement=document.createElement("div"),c.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),r.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),c.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;r.bind(this.backgroundElement,"click",function(){e.hide()})}return $(n,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),c.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var t=this,i=function s(){t.domElement.style.display="none",t.backgroundElement.style.display="none",r.unbind(t.domElement,"webkitTransitionEnd",s),r.unbind(t.domElement,"transitionend",s),r.unbind(t.domElement,"oTransitionEnd",s)};r.bind(this.domElement,"webkitTransitionEnd",i),r.bind(this.domElement,"transitionend",i),r.bind(this.domElement,"oTransitionEnd",i),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-r.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-r.getHeight(this.domElement)/2+"px"}}]),n}(),ps=Qi(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);ls.inject(ps);var $t="dg",Xt=72,Wt=20,Be="Default",ke=function(){try{return!!window.localStorage}catch{return!1}}(),Re=void 0,Yt=!0,be=void 0,ht=!1,Sn=[],y=function n(e){var t=this,i=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),r.addClass(this.domElement,$t),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=c.defaults(i,{closeOnTop:!1,autoPlace:!0,width:n.DEFAULT_WIDTH}),i=c.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),c.isUndefined(i.load)?i.load={preset:Be}:i.preset&&(i.load.preset=i.preset),c.isUndefined(i.parent)&&i.hideable&&Sn.push(this),i.resizable=c.isUndefined(i.parent)&&i.resizable,i.autoPlace&&c.isUndefined(i.scrollable)&&(i.scrollable=!0);var s=ke&&localStorage.getItem(ye(this,"isLocal"))==="true",o=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:i.load.preset},set:function(g){t.parent?t.getRoot().preset=g:i.load.preset=g,vs(this),t.revert()}},width:{get:function(){return i.width},set:function(g){i.width=g,bt(t,g)}},name:{get:function(){return i.name},set:function(g){i.name=g,a&&(a.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(g){i.closed=g,i.closed?r.addClass(t.__ul,n.CLASS_CLOSED):r.removeClass(t.__ul,n.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=g?n.TEXT_OPEN:n.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return s},set:function(g){ke&&(s=g,g?r.bind(window,"unload",o):r.unbind(window,"unload",o),localStorage.setItem(ye(t,"isLocal"),g))}}}),c.isUndefined(i.parent)){if(this.closed=i.closed||!1,r.addClass(this.domElement,n.CLASS_MAIN),r.makeSelectable(this.domElement,!1),ke&&s){t.useLocalStorage=!0;var d=localStorage.getItem(ye(this,"gui"));d&&(i.load=JSON.parse(d))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=n.TEXT_CLOSED,r.addClass(this.__closeButton,n.CLASS_CLOSE_BUTTON),i.closeOnTop?(r.addClass(this.__closeButton,n.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(r.addClass(this.__closeButton,n.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),r.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{i.closed===void 0&&(i.closed=!0);var l=document.createTextNode(i.name);r.addClass(l,"controller-name"),a=Ot(t,l);var u=function(g){return g.preventDefault(),t.closed=!t.closed,!1};r.addClass(this.__ul,n.CLASS_CLOSED),r.addClass(a,"title"),r.bind(a,"click",u),i.closed||(this.closed=!1)}i.autoPlace&&(c.isUndefined(i.parent)&&(Yt&&(be=document.createElement("div"),r.addClass(be,$t),r.addClass(be,n.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(be),Yt=!1),be.appendChild(this.domElement),r.addClass(this.domElement,n.CLASS_AUTO_PLACE)),this.parent||bt(t,i.width)),this.__resizeHandler=function(){t.onResizeDebounced()},r.bind(window,"resize",this.__resizeHandler),r.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),r.bind(this.__ul,"transitionend",this.__resizeHandler),r.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&gs(this),o=function(){ke&&localStorage.getItem(ye(t,"isLocal"))==="true"&&localStorage.setItem(ye(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=o;function f(){var h=t.getRoot();h.width+=1,c.defer(function(){h.width-=1})}i.parent||f()};y.toggleHide=function(){ht=!ht,c.each(Sn,function(n){n.domElement.style.display=ht?"none":""})};y.CLASS_AUTO_PLACE="a";y.CLASS_AUTO_PLACE_CONTAINER="ac";y.CLASS_MAIN="main";y.CLASS_CONTROLLER_ROW="cr";y.CLASS_TOO_TALL="taller-than-window";y.CLASS_CLOSED="closed";y.CLASS_CLOSE_BUTTON="close-button";y.CLASS_CLOSE_TOP="close-top";y.CLASS_CLOSE_BOTTOM="close-bottom";y.CLASS_DRAG="drag";y.DEFAULT_WIDTH=245;y.TEXT_CLOSED="Close Controls";y.TEXT_OPEN="Open Controls";y._keydownHandler=function(n){document.activeElement.type!=="text"&&(n.which===Xt||n.keyCode===Xt)&&y.toggleHide()};r.bind(window,"keydown",y._keydownHandler,!1);c.extend(y.prototype,{add:function(e,t){return Pe(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Pe(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;c.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&be.removeChild(this.domElement);var e=this;c.each(this.__folders,function(t){e.removeFolder(t)}),r.unbind(window,"keydown",y._keydownHandler,!1),Kt(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var i=new y(t);this.__folders[e]=i;var s=Ot(this,i.domElement);return r.addClass(s,"folder"),i},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],Kt(e);var t=this;c.each(e.__folders,function(i){e.removeFolder(i)}),c.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=r.getOffset(e.__ul).top,i=0;c.each(e.__ul.childNodes,function(s){e.autoPlace&&s===e.__save_row||(i+=r.getHeight(s))}),window.innerHeight-t-Wt<i?(r.addClass(e.domElement,y.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-Wt+"px"):(r.removeClass(e.domElement,y.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&c.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:c.debounce(function(){this.onResize()},50),remember:function(){if(c.isUndefined(Re)&&(Re=new fs,Re.domElement.innerHTML=ds),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;c.each(Array.prototype.slice.call(arguments),function(t){e.__rememberedObjects.length===0&&_s(e),e.__rememberedObjects.indexOf(t)===-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&bt(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=We(this)),e.folders={},c.each(this.__folders,function(t,i){e.folders[i]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=We(this),gt(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Be]=We(this,!0)),this.load.remembered[e]=We(this),this.preset=e,vt(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){c.each(this.__controllers,function(t){this.getRoot().load.remembered?En(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),c.each(this.__folders,function(t){t.revert(t)}),e||gt(this.getRoot(),!1)},listen:function(e){var t=this.__listening.length===0;this.__listening.push(e),t&&Cn(this.__listening)},updateDisplay:function(){c.each(this.__controllers,function(e){e.updateDisplay()}),c.each(this.__folders,function(e){e.updateDisplay()})}});function Ot(n,e,t){var i=document.createElement("li");return e&&i.appendChild(e),t?n.__ul.insertBefore(i,t):n.__ul.appendChild(i),n.onResize(),i}function Kt(n){r.unbind(window,"resize",n.__resizeHandler),n.saveToLocalStorageIfPossible&&r.unbind(window,"unload",n.saveToLocalStorageIfPossible)}function gt(n,e){var t=n.__preset_select[n.__preset_select.selectedIndex];e?t.innerHTML=t.value+"*":t.innerHTML=t.value}function ms(n,e,t){if(t.__li=e,t.__gui=n,c.extend(t,{options:function(a){if(arguments.length>1){var d=t.__li.nextElementSibling;return t.remove(),Pe(n,t.object,t.property,{before:d,factoryArgs:[c.toArray(arguments)]})}if(c.isArray(a)||c.isObject(a)){var l=t.__li.nextElementSibling;return t.remove(),Pe(n,t.object,t.property,{before:l,factoryArgs:[a]})}},name:function(a){return t.__li.firstElementChild.firstElementChild.innerHTML=a,t},listen:function(){return t.__gui.listen(t),t},remove:function(){return t.__gui.remove(t),t}}),t instanceof mt){var i=new tt(t.object,t.property,{min:t.__min,max:t.__max,step:t.__step});c.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(o){var a=t[o],d=i[o];t[o]=i[o]=function(){var l=Array.prototype.slice.call(arguments);return d.apply(i,l),a.apply(t,l)}}),r.addClass(e,"has-slider"),t.domElement.insertBefore(i.domElement,t.domElement.firstElementChild)}else if(t instanceof tt){var s=function(a){if(c.isNumber(t.__min)&&c.isNumber(t.__max)){var d=t.__li.firstElementChild.firstElementChild.innerHTML,l=t.__gui.__listening.indexOf(t)>-1;t.remove();var u=Pe(n,t.object,t.property,{before:t.__li.nextElementSibling,factoryArgs:[t.__min,t.__max,t.__step]});return u.name(d),l&&u.listen(),u}return a};t.min=c.compose(s,t.min),t.max=c.compose(s,t.max)}else t instanceof yn?(r.bind(e,"click",function(){r.fakeEvent(t.__checkbox,"click")}),r.bind(t.__checkbox,"click",function(o){o.stopPropagation()})):t instanceof wn?(r.bind(e,"click",function(){r.fakeEvent(t.__button,"click")}),r.bind(e,"mouseover",function(){r.addClass(t.__button,"hover")}),r.bind(e,"mouseout",function(){r.removeClass(t.__button,"hover")})):t instanceof _t&&(r.addClass(e,"color"),t.updateDisplay=c.compose(function(o){return e.style.borderLeftColor=t.__color.toString(),o},t.updateDisplay),t.updateDisplay());t.setValue=c.compose(function(o){return n.getRoot().__preset_select&&t.isModified()&&gt(n.getRoot(),!0),o},t.setValue)}function En(n,e){var t=n.getRoot(),i=t.__rememberedObjects.indexOf(e.object);if(i!==-1){var s=t.__rememberedObjectIndecesToControllers[i];if(s===void 0&&(s={},t.__rememberedObjectIndecesToControllers[i]=s),s[e.property]=e,t.load&&t.load.remembered){var o=t.load.remembered,a=void 0;if(o[n.preset])a=o[n.preset];else if(o[Be])a=o[Be];else return;if(a[i]&&a[i][e.property]!==void 0){var d=a[i][e.property];e.initialValue=d,e.setValue(d)}}}}function Pe(n,e,t,i){if(e[t]===void 0)throw new Error('Object "'+e+'" has no property "'+t+'"');var s=void 0;if(i.color)s=new _t(e,t);else{var o=[e,t].concat(i.factoryArgs);s=cs.apply(n,o)}i.before instanceof pe&&(i.before=i.before.__li),En(n,s),r.addClass(s.domElement,"c");var a=document.createElement("span");r.addClass(a,"property-name"),a.innerHTML=s.property;var d=document.createElement("div");d.appendChild(a),d.appendChild(s.domElement);var l=Ot(n,d,i.before);return r.addClass(l,y.CLASS_CONTROLLER_ROW),s instanceof _t?r.addClass(l,"color"):r.addClass(l,es(s.getValue())),ms(n,l,s),n.__controllers.push(s),s}function ye(n,e){return document.location.href+"."+e}function vt(n,e,t){var i=document.createElement("option");i.innerHTML=e,i.value=e,n.__preset_select.appendChild(i),t&&(n.__preset_select.selectedIndex=n.__preset_select.length-1)}function Jt(n,e){e.style.display=n.useLocalStorage?"block":"none"}function _s(n){var e=n.__save_row=document.createElement("li");r.addClass(n.domElement,"has-save"),n.__ul.insertBefore(e,n.__ul.firstChild),r.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",r.addClass(t,"button gears");var i=document.createElement("span");i.innerHTML="Save",r.addClass(i,"button"),r.addClass(i,"save");var s=document.createElement("span");s.innerHTML="New",r.addClass(s,"button"),r.addClass(s,"save-as");var o=document.createElement("span");o.innerHTML="Revert",r.addClass(o,"button"),r.addClass(o,"revert");var a=n.__preset_select=document.createElement("select");if(n.load&&n.load.remembered?c.each(n.load.remembered,function(h,g){vt(n,g,g===n.preset)}):vt(n,Be,!1),r.bind(a,"change",function(){for(var h=0;h<n.__preset_select.length;h++)n.__preset_select[h].innerHTML=n.__preset_select[h].value;n.preset=this.value}),e.appendChild(a),e.appendChild(t),e.appendChild(i),e.appendChild(s),e.appendChild(o),ke){var d=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage"),u=document.getElementById("dg-save-locally");u.style.display="block",localStorage.getItem(ye(n,"isLocal"))==="true"&&l.setAttribute("checked","checked"),Jt(n,d),r.bind(l,"change",function(){n.useLocalStorage=!n.useLocalStorage,Jt(n,d)})}var f=document.getElementById("dg-new-constructor");r.bind(f,"keydown",function(h){h.metaKey&&(h.which===67||h.keyCode===67)&&Re.hide()}),r.bind(t,"click",function(){f.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),Re.show(),f.focus(),f.select()}),r.bind(i,"click",function(){n.save()}),r.bind(s,"click",function(){var h=prompt("Enter a new preset name.");h&&n.saveAs(h)}),r.bind(o,"click",function(){n.revert()})}function gs(n){var e=void 0;n.__resize_handle=document.createElement("div"),c.extend(n.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function t(o){return o.preventDefault(),n.width+=e-o.clientX,n.onResize(),e=o.clientX,!1}function i(){r.removeClass(n.__closeButton,y.CLASS_DRAG),r.unbind(window,"mousemove",t),r.unbind(window,"mouseup",i)}function s(o){return o.preventDefault(),e=o.clientX,r.addClass(n.__closeButton,y.CLASS_DRAG),r.bind(window,"mousemove",t),r.bind(window,"mouseup",i),!1}r.bind(n.__resize_handle,"mousedown",s),r.bind(n.__closeButton,"mousedown",s),n.domElement.insertBefore(n.__resize_handle,n.domElement.firstElementChild)}function bt(n,e){n.domElement.style.width=e+"px",n.__save_row&&n.autoPlace&&(n.__save_row.style.width=e+"px"),n.__closeButton&&(n.__closeButton.style.width=e+"px")}function We(n,e){var t={};return c.each(n.__rememberedObjects,function(i,s){var o={},a=n.__rememberedObjectIndecesToControllers[s];c.each(a,function(d,l){o[l]=e?d.initialValue:d.getValue()}),t[s]=o}),t}function vs(n){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].value===n.preset&&(n.__preset_select.selectedIndex=e)}function Cn(n){n.length!==0&&hs.call(window,function(){Cn(n)}),c.each(n,function(e){e.updateDisplay()})}var bs=y;const ys="varying vec2 vertexUV;varying vec3 vertexNormal;void main(){vertexUV=uv;vertexNormal=normalize(normalMatrix*normal);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",xs="uniform sampler2D diffuseTexture;varying vec2 vertexUV;varying vec3 vertexNormal;void main(){float intensity=0.7-dot(vertexNormal,vec3(0.0,0.0,1.0));vec3 atmosphere=vec3(0.3,0.6,1.0)*pow(intensity,1.5);gl_FragColor=vec4(atmosphere,1.0);}",ws="varying vec3 vertexNormal;void main(){vertexNormal=normalize(normalMatrix*normal);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",Ss="varying vec3 vertexNormal;void main(){float intensity=pow(0.1-dot(vertexNormal,vec3(0.0,0.0,1.0)),1.1);gl_FragColor=vec4(0.3,0.6,1.0,1.0)*intensity;}",Es="/Planet/assets/diffuse8kvibrance-f70b0745.webp",Cs="/Planet/assets/normal2k-cf6e773f.webp",As="/Planet/assets/roughness2k-1d2db81d.webp",Os="/Planet/assets/clouds4k-782b3e9f.webp",Ts="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Ms="generic-trigger",An=document.querySelector("#c"),R=new ri({canvas:An,antialias:!0});R.setPixelRatio(window.devicePixelRatio);function ks(n){const e=n.domElement,t=e.clientWidth,i=e.clientHeight,s=e.width!==t||e.height!==i;return s&&n.setSize(t,i,!1),s}const Ls=50,Rs=2,Ps=.1,Ns=2e3,_=new li(Ls,Rs,Ps,Ns);_.position.z=500;const J=new di(_,An);J.enablePan=!1;J.maxDistance=1e3;J.minDistance=5.2;J.zoomSpeed=.3;J.rotateSpeed=.3;J.target.set(0,0,0);J.update();const ie=new ci,Ke=new G,he=new ui,Is=new _n;new _n;let x=[],b=null,K=null,nt=null,On=null,A=null,L=[],ft=!0,j=!1,Te=new Y(_.position.x,_.position.y,_.position.z);const Ye=new Y(0,0,0),W=new z;let Tn=!1;const M=new Mi;M.onStart=function(n,e,t){};const Bs=document.getElementById("progress-bar");M.onProgress=function(n,e,t){Bs.value=e/t*100};const zs=document.querySelector(".progress-bar-container");M.onLoad=function(){zs.style.display="none"};M.onError=function(n){console.log("There was an error loading "+n)};const it=document.getElementById("enableVRbutton");it.addEventListener("click",()=>{it.style.display="none",Tn=!0});async function Fs(){navigator.xr.isSessionSupported("immersive-vr").then(n=>{if(n){const e=Le.createButton(R);document.body.appendChild(e),Vs()}})}Tn==!0&&Fs();function Ds(){window.dolly=new z,window.dummyCam=new z,window.workingMatrix=new zi,window.buttonStates={},window.gamepadIndices="",window.info={},window.controllers={},window.elapsedTime=0,window.dollyLat=90,window.dollyLng=180,window.dollyRadius=8,window.XRinSession=!1}function Vs(){R.xr.enabled=!0,Ds(),_.position.set(0,1.6,0);const n=U(dollyLat,dollyLng,dollyRadius);dolly.position.set(n.x,n.y-1.6,n.z),dolly.add(_),ie.add(dolly),_.add(dummyCam),R.xr.getController(0).addEventListener("connected",Hs);const t=new Ji,i=new Q().setFromPoints([new Y(0,0,0),new Y(0,0,-1)]),s=new ki(i);s.scale.z=0,controllers={},controllers.right=Qt(0,s,t),controllers.left=Qt(1,s,t)}function Hs(n){st.style.display="none",ot.style.display="none",Tt.style.display="none",info={},vn(n.data,Ts,Ms).then(({profile:e,assetPath:t})=>{console.log(JSON.stringify(e)),info.name=e.profileId,info.targetRayMode=n.data.targetRayMode,Object.entries(e.layouts).forEach(([i,s])=>{const o={};Object.values(s.components).forEach(a=>{o[a.rootNodeName]=a.gamepadIndices}),info[i]=o}),Gs(info.right),console.log(JSON.stringify(info)),js(info)})}function Gs(n){buttonStates={},gamepadIndices=n,Object.keys(n).forEach(e=>{e.indexOf("touchpad")!=-1||e.indexOf("thumbstick")!=-1?buttonStates[e]={button:0,xAxis:0,yAxis:0}:buttonStates[e]=0})}function js(n){if(n.right!==void 0){const e=R.xr.getController(0);let t=!1,i=!1;Object.keys(n.right).forEach(s=>{s.indexOf("trigger")!=-1&&(t=!0),s.indexOf("squeeze")!=-1&&(i=!0)}),t&&(e.addEventListener("selectstart",Zt),e.addEventListener("selectend",en)),i&&(e.addEventListener("squeezestart",tn),e.addEventListener("squeezeend",nn)),e.addEventListener("disconnected",sn)}if(n.left!==void 0){const e=R.xr.getController(1);let t=!1,i=!1;Object.keys(n.left).forEach(s=>{s.indexOf("trigger")!=-1&&(t=!0),s.indexOf("squeeze")!=-1&&(i=!0)}),t&&(e.addEventListener("selectstart",Zt),e.addEventListener("selectend",en)),i&&(e.addEventListener("squeezestart",tn),e.addEventListener("squeezeend",nn)),e.addEventListener("disconnected",sn)}}function Qt(n,e,t){const i=R.xr.getController(n);i.userData.selectPressed=!1,i.userData.index=n,e&&i.add(e.clone()),dolly.add(i);let s;return t&&(s=R.xr.getControllerGrip(n),s.add(t.createControllerModel(s)),dolly.add(s)),{controller:i,grip:s}}function Zt(){console.log("select"),this.userData.selectPressed=!0}function en(){this.children[0].scale.z=0,this.userData.selectPressed=!1,this.userData.selected=void 0,console.log("selectend")}function tn(){this.userData.squeezePressed=!0,this.userData.selected!==void 0&&(this.attach(this.userData.selected),this.userData.attachedObject=userData.selected),console.log("squeeze")}function nn(){this.userData.squeezePressed=!1,this.userData.attachedObject!==void 0&&(room.attach(this.userData.attachedObject),this.userData.attachedObject=void 0),console.log("squeezeend")}function sn(){const n=userData.index;if(console.log(`Disconnected controller ${n}`),controllers){const e=n==0?controllers.right:controllers.left;if(e){if(e.controller){const t=e.controller;for(;t.children.length>0;)t.remove(t.children[0]);dolly.remove(t)}e.grip&&dolly.remove(e.grip)}}}function Us(n){if(n.userData.selectPressed){n.children[0].scale.z=10,workingMatrix.identity().extractRotation(n.matrixWorld),he.ray.origin.setFromMatrixPosition(n.matrixWorld),he.ray.direction.set(0,0,-1).applyMatrix4(workingMatrix);const e=he.intersectObjects(Ie);if(e.length>0){K=e[0].object;const t=Ie.findIndex(s=>s==e[0].object),i=oe[t][6];i>0&&(ze=document.querySelector(`.carousel.s${i}`),ze.style.display="block"),xrSession.end().then(()=>xrSession=null)}}}function qs(){const e=R.xr.getSession().inputSources[0];if(e&&e.gamepad&&gamepadIndices&&buttonStates){const t=e.gamepad;XRinSession=!0;try{Object.entries(buttonStates).forEach(([i,s])=>{const o=gamepadIndices[i].button;if(i.indexOf("touchpad")!=-1||i.indexOf("thumbstick")!=-1){const a=gamepadIndices[i].xAxis,d=gamepadIndices[i].yAxis;buttonStates[i].button=t.buttons[o].value,buttonStates[i].xAxis=t.axes[a].toFixed(2),buttonStates[i].yAxis=t.axes[d].toFixed(2)}else buttonStates[i]=t.buttons[o].value})}catch{console.warn("An error occurred setting the ui")}}}let on=!1;const He=document.getElementById("introTune");He.preload="auto";He.currentTime=0;He.volume=1;const an=He.duration,st=document.getElementById("playbutton"),Tt=document.getElementById("credits");st.addEventListener("click",()=>{He.play(),st.style.display="none",ot.style.display="none",it.style.display="none",Tt.style.display="none"});const ot=document.getElementById("skipbutton");ot.addEventListener("click",()=>{st.style.display="none",ot.style.display="none",it.style.display="none",Tt.style.display="none",_.position.z=15});let ze;const $s=document.querySelectorAll("[data-carousel-button]");$s.forEach(n=>{n.addEventListener("click",()=>{if(document.querySelector(".carousel"),n.dataset.carouselButton==="exit")ze.style.display="none";else{const e=n.dataset.carouselButton==="next"?1:-1,t=n.closest("[data-carousel]").querySelector("[data-slides]"),i=t.querySelector("[data-active]");let s=[...t.children].indexOf(i)+e;t.children[s].dataset.active=!0,delete i.dataset.active}})});const Xs=document.querySelectorAll("[data-menu-button]");Xs.forEach(n=>{n.addEventListener("click",()=>{if(document.querySelector(".carousel"),n.dataset.menuButton==="menu"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),t=e.querySelector("[data-active]"),i=e.querySelector("[menu]");let s=[...e.children].indexOf(i);e.children[s].dataset.active=!0,delete t.dataset.active}if(n.dataset.menuButton==="definition"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),t=e.querySelector("[data-active]"),i=e.querySelector("[definition]");let s=[...e.children].indexOf(i);e.children[s].dataset.active=!0,delete t.dataset.active}if(n.dataset.menuButton==="exercise"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),t=e.querySelector("[data-active]"),i=e.querySelector("[exercise]");let s=[...e.children].indexOf(i);e.children[s].dataset.active=!0,delete t.dataset.active}if(n.dataset.menuButton==="theory"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),t=e.querySelector("[data-active]"),i=e.querySelector("[theory]");let s=[...e.children].indexOf(i);e.children[s].dataset.active=!0,delete t.dataset.active}if(n.dataset.menuButton==="media"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),t=e.querySelector("[data-active]"),i=e.querySelector("[media]");let s=[...e.children].indexOf(i);e.children[s].dataset.active=!0,delete t.dataset.active}})});const Ws=document.querySelectorAll("[data-nav-button]");Ws.forEach(n=>{n.addEventListener("click",()=>{if(document.querySelector(".carousel"),n.dataset.navButton==="one"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),t=e.querySelector("[data-active]"),i=e.querySelector("[one]");let s=[...e.children].indexOf(i);e.children[s].dataset.active=!0,delete t.dataset.active}if(n.dataset.navButton==="two"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),t=e.querySelector("[data-active]"),i=e.querySelector("[two]");let s=[...e.children].indexOf(i);e.children[s].dataset.active=!0,delete t.dataset.active}if(n.dataset.navButton==="three"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),t=e.querySelector("[data-active]"),i=e.querySelector("[three]");let s=[...e.children].indexOf(i);e.children[s].dataset.active=!0,delete t.dataset.active}if(n.dataset.navButton==="four"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),t=e.querySelector("[data-active]"),i=e.querySelector("[four]");let s=[...e.children].indexOf(i);e.children[s].dataset.active=!0,delete t.dataset.active}if(n.dataset.navButton==="five"){const e=n.closest("[data-carousel]").querySelector("[data-slides]"),t=e.querySelector("[data-active]"),i=e.querySelector("[five]");let s=[...e.children].indexOf(i);e.children[s].dataset.active=!0,delete t.dataset.active}})});const Mn=new Q,kn=new Q,Ln=new Q,Rn=new Q,Pn=new Q,Nn=new Q,In=new Q,Bn=new Q,zn=new Q,Ys=new ee({size:5,map:new D(M).load(hi),transparent:!0,fog:!1}),Ks=new ee({size:5,map:new D(M).load(fi),transparent:!0,fog:!1}),Js=new ee({size:5,map:new D(M).load(pi),transparent:!0,fog:!1}),Qs=new ee({size:5,map:new D(M).load(mi),transparent:!0,fog:!1}),Zs=new ee({size:5,map:new D(M).load(_i),transparent:!0,fog:!1}),eo=new ee({size:5,map:new D(M).load(gi),transparent:!0,fog:!1}),to=new ee({size:5,map:new D(M).load(vi),transparent:!0,fog:!1}),no=new ee({size:5,map:new D(M).load(bi),transparent:!0,fog:!1}),io=new ee({size:5,map:new D(M).load(yi),transparent:!0,fog:!1}),Fn=[];for(let n=0;n<5e3;n++){const e=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3,i=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(t)+Math.abs(i)>400&&Fn.push(e,t,i)}const Dn=[];for(let n=0;n<1e3;n++){const e=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3,i=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(t)+Math.abs(i)>400&&Dn.push(e,t,i)}const Vn=[];for(let n=0;n<500;n++){const e=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3,i=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(t)+Math.abs(i)>400&&Vn.push(e,t,i)}const Hn=[];for(let n=0;n<100;n++){const e=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3,i=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(t)+Math.abs(i)>400&&Hn.push(e,t,i)}const Gn=[];for(let n=0;n<25;n++){const e=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3,i=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(t)+Math.abs(i)>400&&Gn.push(e,t,i)}const jn=[];for(let n=0;n<1e3;n++){const e=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3,i=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(t)+Math.abs(i)>400&&jn.push(e,t,i)}const Un=[];for(let n=0;n<500;n++){const e=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3,i=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(t)+Math.abs(i)>400&&Un.push(e,t,i)}const qn=[];for(let n=0;n<100;n++){const e=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3,i=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(t)+Math.abs(i)>400&&qn.push(e,t,i)}const $n=[];for(let n=0;n<25;n++){const e=(Math.random()-.5)*2e3,t=(Math.random()-.5)*2e3,i=(Math.random()-.5)*2e3;Math.abs(e)+Math.abs(t)+Math.abs(i)>400&&$n.push(e,t,i)}Mn.setAttribute("position",new te(Fn,3));kn.setAttribute("position",new te(Dn,3));Ln.setAttribute("position",new te(Vn,3));Rn.setAttribute("position",new te(Hn,3));Pn.setAttribute("position",new te(Gn,3));Nn.setAttribute("position",new te(jn,3));In.setAttribute("position",new te(Un,3));Bn.setAttribute("position",new te(qn,3));zn.setAttribute("position",new te($n,3));const so=new ne(Mn,Ys),oo=new ne(kn,Ks),ao=new ne(Ln,Js),ro=new ne(Rn,Qs),lo=new ne(Pn,Zs),co=new ne(Nn,eo),uo=new ne(In,to),ho=new ne(Bn,no),fo=new ne(zn,io);ie.add(so,oo,ao,ro,lo,co,uo,ho,fo);const Se=new z;ie.add(Se);const Ge=new z,je=new z,Ue=new z,Ee=new z;Ge.rotation.y=-Math.PI/2.5;Ge.rotation.x=.15;je.rotation.y=2*Math.PI/16;je.rotation.x=.22;Ue.rotation.y=2*Math.PI/2;Ue.rotation.x=.31;Ee.rotation.y=5*Math.PI/3;Ee.rotation.x=-.41;Se.add(Ge);Se.add(je);Se.add(Ue);Se.add(Ee);const re=new D(M);let po=re.load(Es);const Xn=new fe(5,250,250);Xn.computeBoundingSphere();const P=new F(Xn,new wt({map:po,normalMap:re.load(Cs),roughnessMap:re.load(As),normalScale:new G(1,1),metalness:0,roughness:.85,flatShading:!1,side:dn}));ie.add(P);const mo=new cn({map:re.load(Os),transparent:!0,side:un,opacity:.8}),Wn=new F(new fe(5.04,50,50),mo);P.add(Wn);const Yn=new F(new fe(5,500,500),new Je({vertexShader:ys,fragmentShader:xs,blending:hn}));Yn.position.set(0,0,0);P.add(Yn);const Mt=new F(new fe(5.3,50,50),new Je({vertexShader:ws,fragmentShader:Ss,blending:hn,side:xi,transparent:!0,depthWrite:!1}));Mt.position.set(0,0,0);Mt.scale.set(1.2,1.2,1.2);P.add(Mt);const we=new z;P.add(we);for(let n=0;n<_e.length;n++)fn(_e[n].src,_e[n].lat,_e[n].lng-180,_e[n].size/500,_e[n].radius,we);for(let n=0;n<ge.length;n++)fn(ge[n].src,ge[n].lat,ge[n].lng-180,ge[n].size/500,ge[n].radius,W);pn(oe,we,5);pn(Qe,W,7);const Kn=1e-4,kt=3,Jn=.03,Qn=5.01,Fe=new z;P.add(Fe);let Zn=Fe;rt(oe,Et,Kn,kt,Jn,Qn,Zn,!1);rt(oe,Li,Kn,kt,Jn,Qn,Zn,!0);const Lt=new z;W.add(Lt);let _o=Lt;rt(Qe,mn,2e-4,kt,.1,7.01,_o,!1);let De=new z;we.add(De);De.position.set(0,-5.05,0);const go=new ln(M);go.load(wi,function(n){const e=n.scene;De.add(e),e.scale.set(5,5,5),e.rotation.y+=Math.PI/2,e.rotation.x+=Math.PI/3},function(n){},function(n){console.log("An error happened")});const ei=5,vo=new fe(ei,50,50),bo=new xt({map:new D(M).load(Si)}),Ne=new F(vo,bo);Ne.position.set(0,0,490);Ee.add(Ne);const Rt=new St(16777215,1.2,2e3);Rt.position.set(Ne.position.x,Ne.position.y,Ne.position.z-ei*1.5);Ee.add(Rt);const yo=re.load("https://jaranolsen.github.io/Planet/sunflare.webp"),lt=re.load("https://jaranolsen.github.io/Planet/lensflare.webp"),me=new Ei;me.position.set(0,0,0);me.addElement(new Ve(yo,2560,0));me.addElement(new Ve(lt,60,.6));me.addElement(new Ve(lt,70,.7));me.addElement(new Ve(lt,120,.9));me.addElement(new Ve(lt,70,1));Rt.add(me);class Pt{constructor(e,t,i,s,o,a){this.radius=e,this.texture=t,this.z=i,this.rotation=s,this.pivot=o,this.intensity=a}}let xo=new Pt(1.5,Fi,110,-5e-4,Ge,.1),wo=new Pt(2.5,Di,190,-3e-4,je,.05),So=new Pt(1,Vi,250,-1e-4,Ue,.005),ue=[xo,wo,So];for(let n=0;n<ue.length;n++){const e=new F(new fe(ue[n].radius,50,50),new wt({map:new D(M).load(ue[n].texture),metalness:0,flatShading:!1,side:dn}));e.position.set(ue[n].z,0,0),ue[n].pivot.add(e);const t=new St(16777215,ue[n].intensity);t.position.set(ue[n].z,0,0),e.add(t)}let yt=!1;function Eo(){yt=!0,ie.add(W);let n=7,e=9,t=[],i=[];for(let u=0;u<e;u++){t[u]=[],i[u]=[];for(let C=2*Math.PI*u;C<=2*Math.PI*(u+1.0000001);C+=Math.PI/128){let V=Math.sin(C/(e*2)),k=V*n*Math.cos(C),I=V*n*Math.sin(C),H=n/(e*Math.PI)*C;t[u].push(new Y(k,H-n,I)),u==0?C>2*Math.PI*u+(2*Math.PI*(u+1.0000001)-2*Math.PI*u)*.98&&i[u].push(new Y(k,H-n,I)):u<e?(C<2*Math.PI*u+(2*Math.PI*(u+1.0000001)-2*Math.PI*u)*.02&&i[u-1].push(new Y(k,H-n,I)),C>2*Math.PI*u+(2*Math.PI*(u+1.0000001)-2*Math.PI*u)*.98&&i[u].push(new Y(k,H-n,I))):C<2*Math.PI*u+(2*Math.PI*(u+1.0000001)-2*Math.PI*u)*.02&&i[u-1].push(new Y(k,H-n,I))}let f=new zt(t[u]);const h=new ct(f,64,.01,10,!1);h.computeBoundingBox();const g=new Je({uniforms:{color1:{value:new qe(Ce[40+u])},color2:{value:new qe(Ce[40+u+1])},bboxMin:{value:h.boundingBox.min},bboxMax:{value:h.boundingBox.max}},vertexShader:Ft,fragmentShader:Dt}),N=new F(h,g);W.add(N);const E=new ct(f,64,.12-u/70,10,!1),p=new xt({color:Ce[40+u],transparent:!0,opacity:.6}),T=new F(E,p);if(W.add(T),W.rotation.set(0,0,0),u!==0){let C=new zt(i[u-1]);const V=new ct(C,64,.15-u/70,10,!1);V.computeBoundingBox();const k=new Je({uniforms:{color1:{value:new qe(Ce[40+u-1])},color2:{value:new qe(Ce[40+u])},bboxMin:{value:V.boundingBox.min},bboxMax:{value:V.boundingBox.max}},vertexShader:Ft,fragmentShader:Dt}),I=new F(V,k);W.add(I)}}const s=re.load(Ri);s.repeat.set(0,100),s.wrapT=ut,s.rotation=Math.PI/2;const o=re.load(Pi);o.repeat.set(1,100),o.wrapS=ut,o.wrapT=ut,o.rotation=Math.PI/2,o.offset.set(.5,0);const a=new Ni(6.05,.05,50,100),d=new wt({alphaMap:s,transparent:!0,alphaTest:.5,map:o,emissive:16777215,emissiveMap:o,emissiveIntensity:.05,color:16777215,metalness:1,roughness:.7}),l=new F(a,d);l.rotation.x=Math.PI/2,l.position.y=2.34,W.add(l)}const Co=100,m=3e-4,Ao=new cn({color:12312012,side:un}),ce=new Ci;ce.moveTo(m*5,m*5);ce.bezierCurveTo(m*5,m*5,m*4,0,0,0);ce.bezierCurveTo(-m*6,0,-m*6,m*7,-m*6,m*7);ce.bezierCurveTo(-m*6,m*11,-m*3,m*15.4,m*5,m*19);ce.bezierCurveTo(m*12,m*15.4,m*16,m*11,m*16,m*7);ce.bezierCurveTo(m*16,m*7,m*16,0,m*10,0);ce.bezierCurveTo(m*7,0,m*5,m*5,m*5,m*5);const dt=new Ai(ce);dt.center=0;dt.rotateZ(Math.PI/2);dt.rotateY(Math.PI/2);class Oo{constructor(e,t){this.lat=e,this.lng=t,this.gutt=new F(dt,Ao),this.pos=new G(e,t),this.velocity=new G($e(0,0),$e(0,1)).setLength(.001),this.acceleration=new G,this.cartesianPosition=U(this.pos.x,this.pos.y,5.1),this.presentHeading,this.originalHeading,this.gutt.position.set(this.cartesianPosition.x,this.cartesianPosition.y,this.cartesianPosition.z),this.wander=new G(0,0),this.alignment=new G(0,0),this.cohesion=new G(0,0),this.separation=new G(0,0),this.avoidance=new G(0,0),P.add(this.gutt)}move(){this.originalHeading=Math.atan2(this.velocity.x,this.velocity.y),this.acceleration.set(0,0),this.alignment.multiplyScalar(v.alignment),this.cohesion.multiplyScalar(v.cohesion),this.separation.multiplyScalar(v.separation),this.acceleration.add(this.wander),this.acceleration.add(this.alignment),this.acceleration.add(this.cohesion),this.acceleration.add(this.separation),this.acceleration.add(this.avoidance),this.velocity.add(this.acceleration),this.velocity.clampLength(-v.max_speed,v.max_speed),this.velocity.setLength(v.max_speed),this.pos.add(this.velocity),this.pos.x<0&&(this.pos.x=Math.abs(this.pos.x),this.pos.y<180?this.pos.y+=180:this.pos.y-=180,this.velocity.x*=-1,this.velocity.y*=-1),this.pos.x>180&&(this.pos.x=180-(this.pos.x-180),this.pos.y<180?this.pos.y+=180:this.pos.y-=180,this.velocity.x*=-1,this.velocity.y*=-1),this.pos.y<0&&(this.pos.y=360+this.pos.y),this.pos.y>360&&(this.pos.y=this.pos.y-360),this.cartesianPosition=U(this.pos.x,this.pos.y,5.1),this.cartesianVelocity=U(this.velocity.x,this.velocity.y,5.1),this.presentHeading=Math.atan2(this.velocity.x,this.velocity.y),this.cp=new Y,this.cp.set(this.cartesianPosition.x,this.cartesianPosition.y,this.cartesianPosition.z),this.gutt.lookAt(this.cp),this.gutt.rotateZ(this.presentHeading-this.originalHeading),this.gutt.position.set(this.cartesianPosition.x,this.cartesianPosition.y,this.cartesianPosition.z)}calculateWander(){this.wander.set($e(-1e-4,1e-4),$e(-1e-4,1e-4)),this.wander.clampLength(-v.max_force,v.max_force)}calculateAlignment(){let e=0;this.alignment.set(0,0);for(let t=0;t<w.length;t++)w[t]!=this&&this.gutt.position.distanceTo(w[t].gutt.position)<v.alignment_perception_distance&&(this.alignment.add(w[t].velocity),e+=1);e>0&&(this.alignment.set(this.alignment.x/e,this.alignment.y/e),this.alignment.sub(this.velocity),this.alignment.clampLength(-v.max_force,v.max_force))}calculateCohesion(){let e=0;this.cohesion.set(0,0);for(let t=0;t<w.length;t++)w[t]!=this&&this.gutt.position.distanceTo(w[t].gutt.position)<v.cohesion_perception_distance&&(this.cohesion.add(w[t].pos),e+=1);e>0&&(this.cohesion.set(this.cohesion.x/e,this.cohesion.y/e),this.cohesion.sub(this.pos),this.cohesion.clampLength(-v.max_force,v.max_force))}calculateSeparation(){let e=0;this.separation.set(0,0);for(let t=0;t<w.length;t++)if(w[t]!=this&&this.gutt.position.distanceTo(w[t].gutt.position)<v.separation_perception_distance){let i=new G(this.pos.x-w[t].pos.x,this.pos.y-w[t].pos.y);i.divideScalar(this.gutt.position.distanceTo(w[t].gutt.position)),this.separation.add(i),e+=1}e>0&&(this.separation.set(this.separation.x/e,this.separation.y/e),this.separation.clampLength(-v.max_force,v.max_force))}calculateTemperature(){this.avoidance.set(0,0),this.pos.x<40&&(this.avoidance.set(Math.pow(40-this.pos.x,2)/1e5,0),this.avoidance.clampLength(-v.max_force,v.max_force)),this.pos.x>140&&(this.avoidance.set(-Math.pow(140-this.pos.x,2)/1e5,0),this.avoidance.clampLength(-v.max_force,v.max_force))}}let w=[];for(let n=0;n<Co;n++){let e=Ii(40,140,5),t=Bi(0,359);w.push(new Oo(e,t))}const ti=new bs;let v={alignment:.016,alignment_perception_distance:.435,cohesion:.754,cohesion_perception_distance:.887,separation:.765,separation_perception_distance:.225,max_force:.0029,max_speed:.01};const se=ti.addFolder("parameters");se.add(v,"alignment",0,.1,1e-4);se.add(v,"alignment_perception_distance",0,1,.001);se.add(v,"cohesion",0,1,.001);se.add(v,"cohesion_perception_distance",0,1,.001);se.add(v,"separation",0,1,.001);se.add(v,"separation_perception_distance",0,1,.001);se.add(v,"max_force",0,.01,1e-4);se.add(v,"max_speed",0,.1,.001);se.close();ti.hide();const To=new Oi(16777215,.02);ie.add(To);const B=new Ti(15723480,0);B.penumbra=.8;B.angle=Math.PI/8;ie.add(B);let ve=.5;const ni=new St(16777215,.5);ni.position.set(0,0,0);P.add(ni);x.push([oe,oe.length,Et,Fe,5.01]);x.push([Qe,x[x.length-1][1]+Qe.length,mn,Lt,7.01]);function Mo(){he.setFromCamera(Ke,_);const n=he.intersectObjects(Ie);if(n.length==0)for(let e=0;e<Z.length;e++)Z[e].pin.material.color.set(Z[e].originalColor);for(let e=0;e<n.length;e++)n[e].object.material.color.set(16711680)}document.addEventListener("keyup",ko,!1);function ko(n){const e=n.which;if(e==65&&(L.length=0),e==90&&A!==null&&(L.indexOf(A)==-1&&L.push(A),console.log(L)),e==67&&(ft==!0?(P.remove(we),P.remove(Fe),ft=!1):(P.add(we),P.add(Fe),ft=!0)),e==70&&(j==!0?j=!1:j=!0),e==76&&(B.intensity==0?B.intensity=ve:B.intensity==ve?B.intensity=ve*2:B.intensity==ve*2?B.intensity=ve*3:B.intensity==ve*3&&(B.intensity=0)),e==81){let t="";const i=x[b][0];for(let s=0;s<i.length;s++)t=t+'    {id: "'+i[s].id+'", text: '+JSON.stringify(i[s].text)+", lat: "+i[s].lat+", lng: "+i[s].lng+", color: "+i[s].color+", size: "+i[s].size+", slides: "+i[s].slides+`},
`;console.log(t)}if(e==83&&(yt==!1?Eo():(yt=!1,ie.remove(W))),e==87){const t=[x[b][0],x[b][2],x[b][3],x[b][4]];t[2].clear();const i=2e-4,s=3,o=.03;rt(t[0],t[1],i,s,o,t[3],t[2])}if(e==187){let t=0,i=0,s={context:x[b][0]},o;b>0?o=x[b-1][1]:o=0,A&&(t=Z[A].originalSize),s.context[A-o].size+=5,i=s.context[A-o].size,K.scale.set(i/t,i/t,i/t),nt.scale.set(i/t,i/t,i/t)}if(e==189){let t=0,i=0,s={context:x[b][0]},o;b>0?o=x[b-1][1]:o=0,A&&(t=Z[A].originalSize),s.context[A-o].size-=5,i=s.context[A-o].size,K.scale.set(i/t,i/t,i/t),nt.scale.set(i/t,i/t,i/t)}}document.addEventListener("keydown",Lo,!1);function Lo(n){const e=n.which;if(L.length>0){const t={context:x[b][0],length:x[b][1],radius:x[b][4]};for(let i=0;i<L.length;i++)if(e==38||e==40||e==37||e==39){let s=It(Z[L[i]].pin.position.x,Z[L[i]].pin.position.y,Z[L[i]].pin.position.z);e==38?(j&&(s.lat-=.4),s.lat-=.1):e==40?(j&&(s.lat+=.4),s.lat+=.1):e==37?(j&&(s.lng-=.4),s.lng-=.1):e==39&&(j&&(s.lng+=.4),s.lng+=.1);const o=t.radius,a=t.radius+.04,d=t.radius+.05,l=U(s.lat,s.lng,o),u=U(s.lat,s.lng,a),f=U(s.lat,s.lng,d);Z[L[i]].pin.position.set(l.x,l.y,l.z),Ze[L[i]].box.position.set(u.x,u.y,u.z),Ze[L[i]].tag.position.set(f.x,f.y,f.z),s=Bt(s.lat,s.lng-180);let h;b>0?h=x[b-1][1]:h=0,t.context[L[i]-h].lat=s.lat.toFixed(1),t.context[L[i]-h].lng=s.lng.toFixed(1)}}else if(K!=null){const t={context:x[b][0],length:x[b][1],radius:x[b][4]};if(e==38||e==40||e==37||e==39){let i=It(K.position.x,K.position.y,K.position.z);e==38?(j&&(i.lat-=.4),i.lat-=.1):e==40?(j&&(i.lat+=.4),i.lat+=.1):e==37?(j&&(i.lng-=.4),i.lng-=.1):e==39&&(j&&(i.lng+=.4),i.lng+=.1);const s=t.radius,o=t.radius+.04,a=t.radius+.05,d=U(i.lat,i.lng,s),l=U(i.lat,i.lng,o),u=U(i.lat,i.lng,a);K.position.set(d.x,d.y,d.z),nt.position.set(l.x,l.y,l.z),On.position.set(u.x,u.y,u.z),i=Bt(i.lat,i.lng-180);let f;b>0?f=x[b-1][1]:f=0,t.context[A-f].lat=i.lat.toFixed(1),t.context[A-f].lng=i.lng.toFixed(1)}}}const Me=[];let rn;const Ro=document.querySelector("#fpsCounter"),ii=document.createElement("div");function si(){window.requestAnimationFrame(()=>{const n=performance.now();for(;Me.length>0&&Me[0]<=n-1e3;)Me.shift();Me.push(n),rn=Me.length,ii.textContent=rn,si()})}Ro.appendChild(ii);si();oe.length!==Et.length&&console.log("ERROR: tagPlanetData.length !== tagPlanetConnections.length");function Po(){R.setAnimationLoop(No)}function No(n){if(R.xr.isPresenting){const o=Is.getDelta();if(controllers&&Object.values(controllers).forEach(a=>{Us(a.controller)}),elapsedTime===void 0&&(elapsedTime=0),elapsedTime+=o,elapsedTime>.3&&(qs(),elapsedTime=0),XRinSession==!0){const a=Number(buttonStates.xr_standard_thumbstick.xAxis),d=Number(buttonStates.xr_standard_thumbstick.yAxis);if(a!=0||d!=0||buttonStates.a_button!=0||buttonStates.b_button!=0){dollyLng+=a*2,dollyLat+=d,dollyRadius+=(.1*buttonStates.a_button-.1*buttonStates.b_button)*(dollyRadius-5);const l=U(dollyLat,dollyLng,dollyRadius);dolly.position.set(l.x,l.y-1.6,l.z)}}}if(ks(R)){const o=R.domElement;_.aspect=o.clientWidth/o.clientHeight,_.updateProjectionMatrix()}for(let o=0;o<w.length;o++)w[o].calculateWander(),w[o].calculateAlignment(),w[o].calculateCohesion(),w[o].calculateSeparation(),w[o].calculateTemperature(),w[o].move();function e(o){Ke.x=o.clientX/window.innerWidth*2-1,Ke.y=-(o.clientY/window.innerHeight)*2+1}function t(o){he.setFromCamera(Ke,_);const a=he.intersectObjects(Ie);if(a.length>0){K=a[0].object,A=Ie.findIndex(f=>f==a[0].object),nt=Ze[A].box,On=Ze[A].tag;const d=b;for(let f=0;f<100;f++)if(A<x[f][1]){b=f,b!==d&&(L.length=0);break}let l;b>0?l=x[b-1][1]:l=0;let u=x[b][0];if(_.position.distanceTo(K.position)<4&&u[A-l].slides!==void 0){const f=oe[A].slides;ze=document.querySelector(`.carousel.s${f}`),ze.style.display="block"}}}window.addEventListener("pointermove",e),window.addEventListener("mouseup",t),document.addEventListener("touchstart",t),Mo(),R.render(ie,_);const i=_.position,s=_.rotation;B.position.set(i.x,i.y,i.z),B.rotation.set(s.x,s.y,s.z),Se.rotation.y+=-1e-5,Ge.rotation.y+=-3e-4,je.rotation.y+=-3e-5,Ue.rotation.y+=-9e-6,Ee.rotation.y+=1e-4,Wn.rotation.y+=1e-5,_.position.z>15&&on==!0&&(_.position.z-=.0213*Math.pow(_.position.z-10,1.35)/an,P.rotation.y+=5e-4),_.position.z<-15&&on==!0&&(_.position.z+=.213*Math.pow(Math.abs(_.position.z)-10,1.35)/an,P.rotation.y+=5e-4),J.rotateSpeed=(_.position.distanceTo(Ye)-5)/_.position.distanceTo(Ye),J.zoomSpeed=(_.position.distanceTo(Ye)-5)/_.position.distanceTo(Ye)/3,De&&(Te.set(_.position.x,_.position.y,_.position.z),Te.normalize(),De.lookAt(Te.x,Te.y,Te.z)),J.update()}Po();
